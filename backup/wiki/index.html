
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ESP32Async.github.io/ESPAsyncWebServer/backup/wiki/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>ESPAsyncWebServer - ESPAsyncWebServer</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#espasyncwebserver" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ESPAsyncWebServer" class="md-header__button md-logo" aria-label="ESPAsyncWebServer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ESPAsyncWebServer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ESPAsyncWebServer
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ESP32Async/ESPAsyncWebServer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ESP32Async/ESPAsyncWebServer
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ESPAsyncWebServer" class="md-nav__button md-logo" aria-label="ESPAsyncWebServer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ESPAsyncWebServer
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ESP32Async/ESPAsyncWebServer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ESP32Async/ESPAsyncWebServer
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Usage Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Server Setup
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Routing & Matching
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../requests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Requests
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../responses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Responses
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../middleware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Middleware
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../websockets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WebSockets
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../eventsource/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Source (SSE)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../static-files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Serving Static Files
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filters & Rewrites
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help_and_issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Help & Issues
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_of_conduct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code of Conduct
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#asynchronous-http-and-websocket-server-library-for-esp32-esp8266-and-rp2040" class="md-nav__link">
    <span class="md-ellipsis">
      
        Asynchronous HTTP and WebSocket Server Library for ESP32, ESP8266 and RP2040
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-install" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to install
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dependencies
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#esp32-pioarduino" class="md-nav__link">
    <span class="md-ellipsis">
      
        ESP32 / pioarduino
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#esp8266-pioarduino" class="md-nav__link">
    <span class="md-ellipsis">
      
        ESP8266 / pioarduino
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unofficial-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unofficial dependencies
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#important-recommendations-for-build-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Important recommendations for build options
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changes-in-this-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        Changes in this repository
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asyncwebsocketmessagebuffer-and-makebuffer" class="md-nav__link">
    <span class="md-ellipsis">
      
        AsyncWebSocketMessageBuffer and makeBuffer()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-replace-a-response" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to replace a response
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to use Middleware
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-authentication-with-asyncauthenticationmiddleware" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to use authentication with AsyncAuthenticationMiddleware
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-to-middleware-to-improve-performance-and-memory-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Migration to Middleware to improve performance and memory usage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-continuation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Request Continuation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#original-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Original Documentation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Original Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-should-you-care" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why should you care
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#important-things-to-remember" class="md-nav__link">
    <span class="md-ellipsis">
      
        Important things to remember
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principles-of-operation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Principles of operation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Principles of operation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-async-web-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Async Web server
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-life-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Request Life Cycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewrites-and-how-do-they-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rewrites and how do they work
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handlers-and-how-do-they-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handlers and how do they work
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responses-and-how-do-they-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        Responses and how do they work
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#template-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template processing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#libraries-and-projects-that-use-asyncwebserver" class="md-nav__link">
    <span class="md-ellipsis">
      
        Libraries and projects that use AsyncWebServer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Request Variables
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Request Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-post-and-file-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        GET, POST and FILE parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-upload-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        FILE Upload handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#body-data-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Body data handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-body-handling-with-arduinojson" class="md-nav__link">
    <span class="md-ellipsis">
      
        JSON body handling with ArduinoJson
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responses" class="md-nav__link">
    <span class="md-ellipsis">
      
        Responses
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#redirect-to-another-url" class="md-nav__link">
    <span class="md-ellipsis">
      
        Redirect to another URL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-response-with-http-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic response with HTTP Code
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-response-with-http-code-and-extra-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic response with HTTP Code and extra headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-response-with-string-content" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic response with string content
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-response-with-string-content-and-extra-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic response with string content and extra headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-large-webpage-from-progmem" class="md-nav__link">
    <span class="md-ellipsis">
      
        Send large webpage from PROGMEM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-large-webpage-from-progmem-and-extra-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Send large webpage from PROGMEM and extra headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-large-webpage-from-progmem-containing-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Send large webpage from PROGMEM containing templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-large-webpage-from-progmem-containing-templates-and-extra-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Send large webpage from PROGMEM containing templates and extra headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-binary-content-from-progmem" class="md-nav__link">
    <span class="md-ellipsis">
      
        Send binary content from PROGMEM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-coming-from-a-stream" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content coming from a Stream
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-coming-from-a-stream-and-extra-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content coming from a Stream and extra headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-coming-from-a-stream-containing-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content coming from a Stream containing templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-coming-from-a-stream-containing-templates-and-extra-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content coming from a Stream containing templates and extra headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-coming-from-a-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content coming from a File
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-coming-from-a-file-and-extra-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content coming from a File and extra headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-coming-from-a-file-containing-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content coming from a File containing templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-using-a-callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content using a callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-using-a-callback-and-extra-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content using a callback and extra headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-file-content-using-a-callback-and-extra-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with file content using a callback and extra headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-using-a-callback-containing-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content using a callback containing templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond-with-content-using-a-callback-containing-templates-and-extra-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content using a callback containing templates and extra headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunked-response" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunked Response
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunked-response-containing-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunked Response containing templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print-to-response" class="md-nav__link">
    <span class="md-ellipsis">
      
        Print to response
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arduinojson-basic-response" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArduinoJson Basic Response
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arduinojson-advanced-response" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArduinoJson Advanced Response
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serving-static-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Serving static files
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Serving static files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serving-specific-file-by-name" class="md-nav__link">
    <span class="md-ellipsis">
      
        Serving specific file by name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serving-files-in-directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Serving files in directory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serving-static-files-with-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Serving static files with authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specifying-cache-control-header" class="md-nav__link">
    <span class="md-ellipsis">
      
        Specifying Cache-Control header
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specifying-date-modified-header" class="md-nav__link">
    <span class="md-ellipsis">
      
        Specifying Date-Modified header
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specifying-template-processor-callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        Specifying Template Processor callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serving-static-files-by-custom-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Serving static files by custom handling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#param-rewrite-with-matching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Param Rewrite With Matching
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-filters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using filters
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serve-different-site-files-in-ap-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Serve different site files in AP mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewrite-to-different-index-on-ap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rewrite to different index on AP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serving-different-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Serving different hosts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#determine-interface-inside-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Determine interface inside callbacks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bad-responses" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bad Responses
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bad Responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#respond-with-content-using-a-callback-without-content-length-to-http10-clients" class="md-nav__link">
    <span class="md-ellipsis">
      
        Respond with content using a callback without content length to HTTP/1.0 clients
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-websocket-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async WebSocket Plugin
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Async WebSocket Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#async-websocket-event" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async WebSocket Event
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods-for-sending-data-to-a-socket-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        Methods for sending data to a socket client
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#direct-access-to-web-socket-message-buffer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Direct access to web socket message buffer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limiting-the-number-of-web-socket-clients" class="md-nav__link">
    <span class="md-ellipsis">
      
        Limiting the number of web socket clients
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-event-source-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async Event Source Plugin
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Async Event Source Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-event-source-on-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup Event Source on the server
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-event-source-in-the-browser" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup Event Source in the browser
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scanning-for-available-wifi-networks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scanning for available WiFi Networks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-handlers-and-rewrites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Remove handlers and rewrites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting up the server
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting up the server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-global-and-class-functions-as-request-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup global and class functions as request handlers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods-for-controlling-websocket-connections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Methods for controlling websocket connections
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-default-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding Default Headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-variable" class="md-nav__link">
    <span class="md-ellipsis">
      
        Path variable
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="espasyncwebserver">ESPAsyncWebServer<a class="headerlink" href="#espasyncwebserver" title="Permanent link">&para;</a></h1>
<p><a href="https://GitHub.com/ESP32Async/ESPAsyncWebServer/releases/"><img alt="Latest Release" src="https://img.shields.io/github/release/ESP32Async/ESPAsyncWebServer.svg" /></a>
<a href="https://registry.platformio.org/libraries/ESP32Async/ESPAsyncWebServer"><img alt="PlatformIO Registry" src="https://badges.registry.platformio.org/packages/ESP32Async/library/ESPAsyncWebServer.svg" /></a></p>
<p><a href="https://opensource.org/license/lgpl-3-0/"><img alt="License: LGPL 3.0" src="https://img.shields.io/badge/License-LGPL%203.0-yellow.svg" /></a>
<a href="code_of_conduct.md"><img alt="Contributor Covenant" src="https://img.shields.io/badge/Contributor%20Covenant-2.1-4baaaa.svg" /></a></p>
<p><a href="https://GitHub.com/ESP32Async/ESPAsyncWebServer/commit/"><img alt="GitHub latest commit" src="https://badgen.net/github/last-commit/ESP32Async/ESPAsyncWebServer" /></a>
<a href="https://gitpod.io/#https://github.com/ESP32Async/ESPAsyncWebServer"><img alt="Gitpod Ready-to-Code" src="https://img.shields.io/badge/Gitpod-Ready--to--Code-blue?logo=gitpod" /></a></p>
<p><a href="https://discord.gg/X7zpGdyUcY"><img alt="ESP32Async Discord Server" src="https://img.shields.io/badge/Discord-ESP32Async-blue?logo=discord" /></a></p>
<p><a href="https://github.com/ESP32Async/ESPAsyncWebServer/wiki"><img alt="Documentation" src="https://img.shields.io/badge/Wiki-ESPAsyncWebServer-blue?logo=github" /></a></p>
<h2 id="asynchronous-http-and-websocket-server-library-for-esp32-esp8266-and-rp2040">Asynchronous HTTP and WebSocket Server Library for ESP32, ESP8266 and RP2040<a class="headerlink" href="#asynchronous-http-and-websocket-server-library-for-esp32-esp8266-and-rp2040" title="Permanent link">&para;</a></h2>
<p>Supports: WebSocket, SSE, Authentication, Arduino Json 7, File Upload, Static File serving, URL Rewrite, URL Redirect, etc.</p>
<ul>
<li><a href="#compatibility">Compatibility</a></li>
<li><a href="#how-to-install">How to install</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#esp32--pioarduino">ESP32 / pioarduino</a></li>
<li><a href="#esp8266--pioarduino">ESP8266 / pioarduino</a></li>
<li><a href="#unofficial-dependencies">Unofficial dependencies</a></li>
<li><a href="#important-recommendations-for-build-options">Important recommendations for build options</a></li>
<li><a href="#changes-in-this-repository">Changes in this repository</a></li>
<li><a href="#performance">Performance</a></li>
<li><a href="#asyncwebsocketmessagebuffer-and-makebuffer"><code>AsyncWebSocketMessageBuffer</code> and <code>makeBuffer()</code></a></li>
<li><a href="#how-to-replace-a-response">How to replace a response</a></li>
<li><a href="#how-to-use-middleware">How to use Middleware</a></li>
<li><a href="#how-to-use-authentication-with-asyncauthenticationmiddleware">How to use authentication with AsyncAuthenticationMiddleware</a></li>
<li><a href="#migration-to-middleware-to-improve-performance-and-memory-usage">Migration to Middleware to improve performance and memory usage</a></li>
<li><a href="#request-continuation">Request Continuation</a></li>
<li><a href="#original-documentation">Original Documentation</a></li>
</ul>
<h2 id="compatibility">Compatibility<a class="headerlink" href="#compatibility" title="Permanent link">&para;</a></h2>
<ul>
<li>ESP32, ESP8266, RP2040</li>
<li>Arduino Core 2.x and 3.x</li>
</ul>
<h2 id="how-to-install">How to install<a class="headerlink" href="#how-to-install" title="Permanent link">&para;</a></h2>
<p>The library can be downloaded from the releases page at <a href="https://github.com/ESP32Async/ESPAsyncWebServer/releases">https://github.com/ESP32Async/ESPAsyncWebServer/releases</a>.</p>
<p>It is also deployed in these registries:</p>
<ul>
<li>
<p>Arduino Library Registry: <a href="https://github.com/arduino/library-registry">https://github.com/arduino/library-registry</a></p>
</li>
<li>
<p>ESP Component Registry <a href="https://components.espressif.com/components/esp32async/espasyncwebserver">https://components.espressif.com/components/esp32async/espasyncwebserver</a></p>
</li>
<li>
<p>PlatformIO Registry: <a href="https://registry.platformio.org/libraries/esp32async/ESPAsyncWebServer">https://registry.platformio.org/libraries/esp32async/ESPAsyncWebServer</a></p>
</li>
<li>
<p>Use: <code>lib_deps=ESP32Async/ESPAsyncWebServer</code> to point to latest version</p>
</li>
<li>Use: <code>lib_deps=ESP32Async/ESPAsyncWebServer @ ^&lt;x.y.z&gt;</code> to point to latest version with the same major version</li>
<li>Use: <code>lib_deps=ESP32Async/ESPAsyncWebServer @ &lt;x.y.z&gt;</code> to always point to the same version (reproductible build)</li>
</ul>
<h2 id="dependencies">Dependencies<a class="headerlink" href="#dependencies" title="Permanent link">&para;</a></h2>
<h3 id="esp32-pioarduino">ESP32 / pioarduino<a class="headerlink" href="#esp32-pioarduino" title="Permanent link">&para;</a></h3>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">[env:stable]</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="na">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="na">lib_compat_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">strict</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="na">lib_ldf_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">chain</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="na">lib_deps</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="na">ESP32Async/AsyncTCP</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="na">ESP32Async/ESPAsyncWebServer</span>
</span></code></pre></div>
<h3 id="esp8266-pioarduino">ESP8266 / pioarduino<a class="headerlink" href="#esp8266-pioarduino" title="Permanent link">&para;</a></h3>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">[env:stable]</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="na">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">espressif8266</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="na">lib_compat_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">strict</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="na">lib_ldf_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">chain</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="na">lib_deps</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span><span class="na">ESP32Async/ESPAsyncTCP</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="na">ESP32Async/ESPAsyncWebServer</span>
</span></code></pre></div>
<h3 id="unofficial-dependencies">Unofficial dependencies<a class="headerlink" href="#unofficial-dependencies" title="Permanent link">&para;</a></h3>
<p><strong>AsyncTCPSock</strong></p>
<p>AsyncTCPSock can be used instead of AsyncTCP by excluding AsyncTCP from the library dependencies and adding AsyncTCPSock instead:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="na">lib_compat_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">strict</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="na">lib_ldf_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">chain</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="na">lib_deps</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="na">https</span><span class="o">:</span><span class="s">//github.com/ESP32Async/AsyncTCPSock/archive/refs/tags/v1.0.3-dev.zip</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="na">ESP32Async/ESPAsyncWebServer</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="na">lib_ignore</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="na">AsyncTCP</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="na">ESP32Async/AsyncTCP</span>
</span></code></pre></div>
<p><strong>AsyncTCP_RP2040W</strong></p>
<p>AsyncTCP_RP2040W provides support for RP2040 and replaced AsyncTCP in this case:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="na">lib_compat_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">strict</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="na">lib_ldf_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">chain</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="na">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://github.com/maxgerhardt/platform-raspberrypi.git</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="na">board</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">rpipicow</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="na">board_build.core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">earlephilhower</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="na">lib_deps</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span><span class="na">khoih-prog/AsyncTCP_RP2040W @ 1.2.0</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">  </span><span class="na">ESP32Async/ESPAsyncWebServer</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="na">lib_ignore</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span><span class="na">lwIP_ESPHost</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="na">build_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${env.build_flags}</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">  </span><span class="na">-Wno-missing-field-initializers</span>
</span></code></pre></div>
<h2 id="important-recommendations-for-build-options">Important recommendations for build options<a class="headerlink" href="#important-recommendations-for-build-options" title="Permanent link">&para;</a></h2>
<p>Most of the crashes are caused by improper use or configuration of the AsyncTCP library used for the project.
Here are some recommendations to avoid them and build-time flags you can change.</p>
<p><code>CONFIG_ASYNC_TCP_MAX_ACK_TIME</code> - defines a timeout for TCP connection to be considered alive when waiting for data.
In some bad network conditions you might consider increasing it.</p>
<p><code>CONFIG_ASYNC_TCP_QUEUE_SIZE</code> - defines the length of the queue for events related to connections handling.
Both the server and AsyncTCP library were optimized to control the queue automatically. Do NOT try blindly increasing the queue size, it does not help you in a way you might think it is. If you receive debug messages about queue throttling, try to optimize your server callbacks code to execute as fast as possible.
Read #165 thread, it might give you some hints.</p>
<p><code>CONFIG_ASYNC_TCP_RUNNING_CORE</code> - CPU core thread affinity that runs the queue events handling and executes server callbacks. Default is ANY core, so it means that for dualcore SoCs both cores could handle server activities. If your server's code is too heavy and unoptimized or you see that sometimes
server might affect other network activities, you might consider to bind it to the same core that runs Arduino code (1) to minimize affect on radio part. Otherwise you can leave the default to let RTOS decide where to run the thread based on priority</p>
<p><code>CONFIG_ASYNC_TCP_STACK_SIZE</code> - stack size for the thread that runs sever events and callbacks. Default is 16k that is a way too much waste for well-defined short async code or simple static file handling. You might want to cosider reducing it to 4-8k to same RAM usage. If you do not know what this is or not sure about your callback code demands - leave it as default, should be enough even for very hungry callbacks in most cases.</p>
<blockquote>
<p>[!NOTE]
This relates to ESP32 only, ESP8266 uses different ESPAsyncTCP lib that does not has this build options</p>
</blockquote>
<p>I personally use the following configuration in my projects:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="w">  </span><span class="o">-</span><span class="n">D</span><span class="w"> </span><span class="n">CONFIG_ASYNC_TCP_MAX_ACK_TIME</span><span class="o">=</span><span class="mi">5000</span><span class="w">   </span><span class="c1">// (keep default)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="o">-</span><span class="n">D</span><span class="w"> </span><span class="n">CONFIG_ASYNC_TCP_PRIORITY</span><span class="o">=</span><span class="mi">10</span><span class="w">         </span><span class="c1">// (keep default)</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="o">-</span><span class="n">D</span><span class="w"> </span><span class="n">CONFIG_ASYNC_TCP_QUEUE_SIZE</span><span class="o">=</span><span class="mi">64</span><span class="w">       </span><span class="c1">// (keep default)</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="o">-</span><span class="n">D</span><span class="w"> </span><span class="n">CONFIG_ASYNC_TCP_RUNNING_CORE</span><span class="o">=</span><span class="mi">1</span><span class="w">      </span><span class="c1">// force async_tcp task to be on same core as Arduino app (default is any core)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="o">-</span><span class="n">D</span><span class="w"> </span><span class="n">CONFIG_ASYNC_TCP_STACK_SIZE</span><span class="o">=</span><span class="mi">4096</span><span class="w">     </span><span class="c1">// reduce the stack size (default is 16K)</span>
</span></code></pre></div>
<p>If you need to serve chunk requests with a really low buffer (which should be avoided), you can set <code>-D ASYNCWEBSERVER_USE_CHUNK_INFLIGHT=0</code> to disable the in-flight control.</p>
<h2 id="changes-in-this-repository">Changes in this repository<a class="headerlink" href="#changes-in-this-repository" title="Permanent link">&para;</a></h2>
<ul>
<li>(bug) A lot of bug fixes</li>
<li>(ci) Better CI with a complete matrix of Arduino versions and boards</li>
<li>(ci) Deployed in PlatformIO registry and Arduino IDE library manager</li>
<li>(feat) <strong>Arduino 3 / ESP-IDF 5</strong> compatibility</li>
<li>(feat) <strong>ArduinoJson 7</strong> compatibility</li>
<li>(feat) <strong>ESP32 / ESP8266 / RP2040</strong> support</li>
<li>(feat) <strong>MessagePack</strong> support</li>
<li>(feat) <strong>Middleware</strong> support with pre-built middlewares for authentication, authorization, rate limiting, logging, cors, etc.</li>
<li>(feat) <strong>Request attributes</strong> to store data on the request object</li>
<li>(feat) <strong>Response header</strong> control and override</li>
<li>(feat) <strong>Response override</strong>: support the ability to replace a previously sent response by another one</li>
<li>(feat) <strong>Resumable download</strong> support using HEAD and bytes range</li>
<li>(feat) <code>StreamConcat</code> example to show how to stream multiple files in one response</li>
<li>(feat) Removed ESPIDF Editor (this is not the role of a web server library to do that - get the source files from the original repos if required)</li>
<li>(perf) <a href="https://github.com/ESP32Async/AsyncTCPSock">AsyncTCPSock</a> support: AsyncTCP can be ignored and AsyncTCPSock used instead</li>
<li>(perf) <code>char*</code> overloads to avoid using <code>String</code></li>
<li>(perf) <code>DEFAULT_MAX_WS_CLIENTS</code> to change the number of allows WebSocket clients and use <code>cleanupClients()</code> to help cleanup resources about dead clients</li>
<li>(perf) <code>setCloseClientOnQueueFull(bool)</code> which can be set on a client to either close the connection or discard messages but not close the connection when the queue is full</li>
<li>(perf) <code>SSE_MAX_QUEUED_MESSAGES</code> to control the maximum number of messages that can be queued for a SSE client</li>
<li>(perf) <code>WS_MAX_QUEUED_MESSAGES</code>: control the maximum number of messages that can be queued for a Websocket client</li>
<li>(perf) in-flight buffer control and queue congestion avoidance to help to improve parallel connections handling, high volume data transfers and mitigate poor implemented slow user-code callbacks delayes on connections handling</li>
<li>(perf) Code size improvements</li>
<li>(perf) Lot of code cleanup and optimizations</li>
<li>(perf) Performance improvements in terms of memory, speed and size</li>
</ul>
<p><strong>WARNING: Important notes about future version 4.x</strong></p>
<p>ESPAsyncWebServer is now at version 3.x, where we try to keep the API compatibility with original project as much as possible.</p>
<p>We plan on creating a next major 4.x version that will:</p>
<ol>
<li>Drop support for ESP8266, which goes EOL in a few years</li>
<li>Drop support for Arduino 2.x and ESP-IDF 4.x. The library will be compatible with latest Arduino and ESP-IDF</li>
<li>Drop support for ArduinoJson 5.x and 6.x. The library will be compatible with latest ArduinoJson</li>
</ol>
<p>So if you need one of these feature, you will have to stick with the current 3.x.
All releases we do will not cease to exist: all 3.x releases will stay in the release page.
That is why we have tags and a release cycle.</p>
<p>Maintaining a library for ESP8266 and RP2040 has a real cost and clearly what we see is that most users helping are on ESP32.</p>
<p>If you are an ESP8266 user and want to help improve current 3.x, you are more than welcomed to contribute to this community effort.</p>
<h2 id="performance">Performance<a class="headerlink" href="#performance" title="Permanent link">&para;</a></h2>
<p>Performance of <code>ESP32Async/ESPAsyncWebServer</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>&gt;<span class="w"> </span>brew<span class="w"> </span>install<span class="w"> </span>autocannon
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>&gt;<span class="w"> </span>autocannon<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span><span class="w"> </span>-w<span class="w"> </span><span class="m">10</span><span class="w"> </span>-d<span class="w"> </span><span class="m">20</span><span class="w"> </span>http://192.168.4.1
</span></code></pre></div>
<p>With <code>ESP32Async/AsyncTCP</code></p>
<p><img width="629" alt="perf-c10" src="https://github.com/user-attachments/assets/b4b7f953-c24d-4e04-8d87-ba3f26805737" /></p>
<p>With <code>https://github.com/ESP32Async/AsyncTCPSock/archive/refs/tags/v1.0.3-dev.zip</code>:</p>
<p><img width="654" alt="perf-c10-asynctcpsock" src="https://github.com/user-attachments/assets/0dacf133-ca47-40be-939b-e6f60fc95b81" /></p>
<p><strong>SSE performance</strong></p>
<p>In the example, there is an endpoint <code>/events</code> with some comments showing how these metrics are calculated.</p>
<p>Test is running for 20 seconds with 10 connections.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>// With AsyncTCP, with 10 workers: no message discarded from the queue
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>//
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>// Total: 2038 events, 509.50 events / second
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>// Total: 2120 events, 530.00 events / second
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>// Total: 2119 events, 529.75 events / second
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>// Total: 2038 events, 509.50 events / second
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>// Total: 2037 events, 509.25 events / second
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>// Total: 2119 events, 529.75 events / second
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>// Total: 2119 events, 529.75 events / second
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>// Total: 2120 events, 530.00 events / second
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>// Total: 2038 events, 509.50 events / second
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>// Total: 2038 events, 509.50 events / second
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>//
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>// With AsyncTCPSock, with 10 workers: no message discarded from the queue
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>//
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>// Total: 2038 events, 509.50 events / second
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>// Total: 2120 events, 530.00 events / second
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>// Total: 2119 events, 529.75 events / second
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>// Total: 2038 events, 509.50 events / second
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>// Total: 2037 events, 509.25 events / second
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>// Total: 2119 events, 529.75 events / second
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>// Total: 2119 events, 529.75 events / second
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>// Total: 2120 events, 530.00 events / second
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>// Total: 2038 events, 509.50 events / second
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>// Total: 2038 events, 509.50 events / second
</span></code></pre></div>
<h2 id="asyncwebsocketmessagebuffer-and-makebuffer"><code>AsyncWebSocketMessageBuffer</code> and <code>makeBuffer()</code><a class="headerlink" href="#asyncwebsocketmessagebuffer-and-makebuffer" title="Permanent link">&para;</a></h2>
<p>The fork from <a href="https://github.com/yubox-node-org/ESPAsyncWebServer">yubox-node-org</a> introduces some breaking API changes compared to the original library, especially regarding the use of <code>std::shared_ptr&lt;std::vector&lt;uint8_t&gt;&gt;</code> for WebSocket.</p>
<p>This library is compatible with the original library from <a href="https://github.com/me-no-dev/ESPAsyncWebServer">me-no-dev</a> regarding WebSocket, and wraps the optimizations done by <code>yubox-node-org</code> in the <code>AsyncWebSocketMessageBuffer</code> class.
So you have the choice of which API to use.</p>
<p>Here are examples for serializing a Json document in a websocket message buffer:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="n">JsonDocument</span><span class="o">&amp;</span><span class="w"> </span><span class="n">doc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measureJson</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span><span class="c1">// original API from me-no-dev</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">  </span><span class="n">AsyncWebSocketMessageBuffer</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_ws</span><span class="o">-&gt;</span><span class="n">makeBuffer</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span><span class="w"> </span><span class="c1">// up to you to keep or remove this</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">  </span><span class="n">serializeJson</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">  </span><span class="n">_ws</span><span class="o">-&gt;</span><span class="n">textAll</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="n">JsonDocument</span><span class="o">&amp;</span><span class="w"> </span><span class="n">doc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measureJson</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="c1">// this fork (originally from yubox-node-org), uses another API with shared pointer</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span><span class="w"> </span><span class="c1">// up to you to keep or remove this</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">  </span><span class="n">serializeJson</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">  </span><span class="n">_ws</span><span class="o">-&gt;</span><span class="n">textAll</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="p">}</span>
</span></code></pre></div>
<p>I recommend to use the official API <code>AsyncWebSocketMessageBuffer</code> to retain further compatibility.</p>
<h2 id="how-to-replace-a-response">How to replace a response<a class="headerlink" href="#how-to-replace-a-response" title="Permanent link">&para;</a></h2>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="w">  </span><span class="c1">// It is possible to replace a response.</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="c1">// The previous one will be deleted.</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="c1">// Response sending happens when the handler returns.</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/replace&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_GET</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">AsyncWebServerRequest</span><span class="o">*</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello, world&quot;</span><span class="p">);</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="c1">// oups! finally we want to send a different response</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;validation error&quot;</span><span class="p">);</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">  </span><span class="p">});</span>
</span></code></pre></div>
<p>This will send error 400 instead of 200.</p>
<h2 id="how-to-use-middleware">How to use Middleware<a class="headerlink" href="#how-to-use-middleware" title="Permanent link">&para;</a></h2>
<p>Middleware is a way to intercept requests to perform some operations on them, like authentication, authorization, logging, etc and also act on the response headers.</p>
<p>Middleware can either be attached to individual handlers, attached at the server level (thus applied to all handlers), or both.
They will be executed in the order they are attached, and they can stop the request processing by sending a response themselves.</p>
<p>You can have a look at the <a href="https://github.com/ESP32Async/ESPAsyncWebServer/blob/main/examples">examples</a> for some use cases.</p>
<p>For example, such middleware would handle authentication and set some attributes on the request to make them available for the next middleware and for the handler which will process the request.</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">AsyncMiddlewareFunction</span><span class="w"> </span><span class="nf">complexAuth</span><span class="p">([](</span><span class="n">AsyncWebServerRequest</span><span class="o">*</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">ArMiddlewareNext</span><span class="w"> </span><span class="n">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">authenticate</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;password&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">requestAuthentication</span><span class="p">();</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mathieu&quot;</span><span class="p">);</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">  </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&quot;role&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;staff&quot;</span><span class="p">);</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">  </span><span class="n">next</span><span class="p">();</span><span class="w"> </span><span class="c1">// continue processing</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">  </span><span class="c1">// you can act one the response object</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">  </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;X-Rate-Limit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;200&quot;</span><span class="p">);</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="p">});</span>
</span></code></pre></div>
<p><strong>Here are the list of available middlewares:</strong></p>
<ul>
<li><code>AsyncMiddlewareFunction</code>: can convert a lambda function (<code>ArMiddlewareCallback</code>) to a middleware</li>
<li><code>AsyncAuthenticationMiddleware</code>: to handle basic/digest authentication globally or per handler</li>
<li><code>AsyncAuthorizationMiddleware</code>: to handle authorization globally or per handler</li>
<li><code>AsyncCorsMiddleware</code>: to handle CORS preflight request globally or per handler</li>
<li><code>AsyncHeaderFilterMiddleware</code>: to filter out headers from the request</li>
<li><code>AsyncHeaderFreeMiddleware</code>: to only keep some headers from the request, and remove the others</li>
<li><code>LoggerMiddleware</code>: to log requests globally or per handler with the same pattern as curl. Will also record request processing time</li>
<li><code>AsyncRateLimitMiddleware</code>: to limit the number of requests on a windows of time globally or per handler</li>
</ul>
<h2 id="how-to-use-authentication-with-asyncauthenticationmiddleware">How to use authentication with AsyncAuthenticationMiddleware<a class="headerlink" href="#how-to-use-authentication-with-asyncauthenticationmiddleware" title="Permanent link">&para;</a></h2>
<p>Do not use the <code>setUsername()</code> and <code>setPassword()</code> methods on the handlers anymore.
They are deprecated.
These methods were causing a copy of the username and password for each handler, which is not efficient.</p>
<p>Now, you can use the <code>AsyncAuthenticationMiddleware</code> to handle authentication globally or per handler.</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">AsyncAuthenticationMiddleware</span><span class="w"> </span><span class="n">authMiddleware</span><span class="p">;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c1">// [...]</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">authMiddleware</span><span class="p">.</span><span class="n">setAuthType</span><span class="p">(</span><span class="n">AsyncAuthType</span><span class="o">::</span><span class="n">AUTH_DIGEST</span><span class="p">);</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="n">authMiddleware</span><span class="p">.</span><span class="n">setRealm</span><span class="p">(</span><span class="s">&quot;My app name&quot;</span><span class="p">);</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">authMiddleware</span><span class="p">.</span><span class="n">setUsername</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">);</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="n">authMiddleware</span><span class="p">.</span><span class="n">setPassword</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">);</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="n">authMiddleware</span><span class="p">.</span><span class="n">setAuthFailureMessage</span><span class="p">(</span><span class="s">&quot;Authentication failed&quot;</span><span class="p">);</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="n">authMiddleware</span><span class="p">.</span><span class="n">generateHash</span><span class="p">();</span><span class="w"> </span><span class="c1">// optimization to avoid generating the hash at each request</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="c1">// [...]</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="n">server</span><span class="p">.</span><span class="n">addMiddleware</span><span class="p">(</span><span class="o">&amp;</span><span class="n">authMiddleware</span><span class="p">);</span><span class="w"> </span><span class="c1">// globally add authentication to the server</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="c1">// [...]</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="n">myHandler</span><span class="p">.</span><span class="n">addMiddleware</span><span class="p">(</span><span class="o">&amp;</span><span class="n">authMiddleware</span><span class="p">);</span><span class="w"> </span><span class="c1">// add authentication to a specific handler</span>
</span></code></pre></div>
<h2 id="migration-to-middleware-to-improve-performance-and-memory-usage">Migration to Middleware to improve performance and memory usage<a class="headerlink" href="#migration-to-middleware-to-improve-performance-and-memory-usage" title="Permanent link">&para;</a></h2>
<ul>
<li><code>AsyncEventSource.authorizeConnect(...)</code> =&gt; do not use this method anymore: add a common <code>AsyncAuthorizationMiddleware</code> to the handler or server, and make sure to add it AFTER the <code>AsyncAuthenticationMiddleware</code> if you use authentication.</li>
<li><code>AsyncWebHandler.setAuthentication(...)</code> =&gt; do not use this method anymore: add a common <code>AsyncAuthenticationMiddleware</code> to the handler or server</li>
<li><code>ArUploadHandlerFunction</code> and <code>ArBodyHandlerFunction</code> =&gt; these callbacks receiving body data and upload and not calling anymore the authentication code for performance reasons.
  These callbacks can be called multiple times during request parsing, so this is up to the user to now call the <code>AsyncAuthenticationMiddleware.allowed(request)</code> if needed and ideally when the method is called for the first time.
  These callbacks are also not triggering the whole middleware chain since they are not part of the request processing workflow (they are not the final handler).</li>
</ul>
<h2 id="request-continuation">Request Continuation<a class="headerlink" href="#request-continuation" title="Permanent link">&para;</a></h2>
<p>Request Continuation is the ability to pause the processing of a request (the actual sending over the network) to be able to let another task commit the response on the network later.</p>
<p>This is a common supported use case amongst web servers.</p>
<p>A usage example can be found in the example called <a href="https://github.com/ESP32Async/ESPAsyncWebServer/blob/main/examples/RequestContinuation/RequestContinuation.ino">RequestContinuation.ino</a></p>
<p>In the handler receiving the request, just execute:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">AsyncWebServerRequestPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">pause</span><span class="p">();</span>
</span></code></pre></div>
<p>This will pause the request and return a <code>AsyncWebServerRequestPtr</code> (this is a weak pointer).</p>
<p><strong>The AsyncWebServerRequestPtr is the ONLY object authorized to leave the scope of the request handler.</strong></p>
<p>Save somewhere this smart pointer and use it later to commit the response like this:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">// you can check for expiration</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">requestPtr</span><span class="p">.</span><span class="n">expired</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="c1">// the request connection was closed some time ago so the request is not accessible anymore</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">longRunningTaskFinished</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">  </span><span class="c1">// this is what you always need to do when you want to access the request.</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requestPtr</span><span class="p">.</span><span class="n">lock</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="c1">// send back the response</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">contentType</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">    </span><span class="c1">// the connection has been closed so the request is not accessible anymore</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>Most of the time you can simply do like below if checking expiration is not needed:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requestPtr</span><span class="p">.</span><span class="n">lock</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="c1">// send back the response</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">contentType</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="original-documentation">Original Documentation<a class="headerlink" href="#original-documentation" title="Permanent link">&para;</a></h2>
<!-- no toc -->

<ul>
<li><a href="#why-should-you-care">Why should you care</a></li>
<li><a href="#important-things-to-remember">Important things to remember</a></li>
<li><a href="#principles-of-operation">Principles of operation</a></li>
<li><a href="#the-async-web-server">The Async Web server</a></li>
<li><a href="#request-life-cycle">Request Life Cycle</a></li>
<li><a href="#rewrites-and-how-do-they-work">Rewrites and how do they work</a></li>
<li><a href="#handlers-and-how-do-they-work">Handlers and how do they work</a></li>
<li><a href="#responses-and-how-do-they-work">Responses and how do they work</a></li>
<li><a href="#template-processing">Template processing</a></li>
<li><a href="#libraries-and-projects-that-use-asyncwebserver">Libraries and projects that use AsyncWebServer</a></li>
<li><a href="#request-variables">Request Variables</a></li>
<li><a href="#common-variables">Common Variables</a></li>
<li><a href="#headers">Headers</a></li>
<li><a href="#get-post-and-file-parameters">GET, POST and FILE parameters</a></li>
<li><a href="#file-upload-handling">FILE Upload handling</a></li>
<li><a href="#body-data-handling">Body data handling</a></li>
<li><a href="#json-body-handling-with-arduinojson">JSON body handling with ArduinoJson</a></li>
<li><a href="#responses">Responses</a></li>
<li><a href="#redirect-to-another-url">Redirect to another URL</a></li>
<li><a href="#basic-response-with-http-code">Basic response with HTTP Code</a></li>
<li><a href="#basic-response-with-http-code-and-extra-headers">Basic response with HTTP Code and extra headers</a></li>
<li><a href="#basic-response-with-string-content">Basic response with string content</a></li>
<li><a href="#basic-response-with-string-content-and-extra-headers">Basic response with string content and extra headers</a></li>
<li><a href="#send-large-webpage-from-progmem">Send large webpage from PROGMEM</a></li>
<li><a href="#send-large-webpage-from-progmem-and-extra-headers">Send large webpage from PROGMEM and extra headers</a></li>
<li><a href="#send-large-webpage-from-progmem-containing-templates">Send large webpage from PROGMEM containing templates</a></li>
<li><a href="#send-large-webpage-from-progmem-containing-templates-and-extra-headers">Send large webpage from PROGMEM containing templates and extra headers</a></li>
<li><a href="#send-binary-content-from-progmem">Send binary content from PROGMEM</a></li>
<li><a href="#respond-with-content-coming-from-a-stream">Respond with content coming from a Stream</a></li>
<li><a href="#respond-with-content-coming-from-a-stream-and-extra-headers">Respond with content coming from a Stream and extra headers</a></li>
<li><a href="#respond-with-content-coming-from-a-stream-containing-templates">Respond with content coming from a Stream containing templates</a></li>
<li><a href="#respond-with-content-coming-from-a-stream-containing-templates-and-extra-headers">Respond with content coming from a Stream containing templates and extra headers</a></li>
<li><a href="#respond-with-content-coming-from-a-file">Respond with content coming from a File</a></li>
<li><a href="#respond-with-content-coming-from-a-file-and-extra-headers">Respond with content coming from a File and extra headers</a></li>
<li><a href="#respond-with-content-coming-from-a-file-containing-templates">Respond with content coming from a File containing templates</a></li>
<li><a href="#respond-with-content-using-a-callback">Respond with content using a callback</a></li>
<li><a href="#respond-with-content-using-a-callback-and-extra-headers">Respond with content using a callback and extra headers</a></li>
<li><a href="#respond-with-file-content-using-a-callback-and-extra-headers">Respond with file content using a callback and extra headers</a></li>
<li><a href="#respond-with-content-using-a-callback-containing-templates">Respond with content using a callback containing templates</a></li>
<li><a href="#respond-with-content-using-a-callback-containing-templates-and-extra-headers">Respond with content using a callback containing templates and extra headers</a></li>
<li><a href="#chunked-response">Chunked Response</a></li>
<li><a href="#chunked-response-containing-templates">Chunked Response containing templates</a></li>
<li><a href="#print-to-response">Print to response</a></li>
<li><a href="#arduinojson-basic-response">ArduinoJson Basic Response</a></li>
<li><a href="#arduinojson-advanced-response">ArduinoJson Advanced Response</a></li>
<li><a href="#serving-static-files">Serving static files</a></li>
<li><a href="#serving-specific-file-by-name">Serving specific file by name</a></li>
<li><a href="#serving-files-in-directory">Serving files in directory</a></li>
<li><a href="#serving-static-files-with-authentication">Serving static files with authentication</a></li>
<li><a href="#specifying-cache-control-header">Specifying Cache-Control header</a></li>
<li><a href="#specifying-date-modified-header">Specifying Date-Modified header</a></li>
<li><a href="#specifying-template-processor-callback">Specifying Template Processor callback</a></li>
<li><a href="#serving-static-files-by-custom-handling">Serving static files by custom handling</a></li>
<li><a href="#param-rewrite-with-matching">Param Rewrite With Matching</a></li>
<li><a href="#using-filters">Using filters</a></li>
<li><a href="#serve-different-site-files-in-ap-mode">Serve different site files in AP mode</a></li>
<li><a href="#rewrite-to-different-index-on-ap">Rewrite to different index on AP</a></li>
<li><a href="#serving-different-hosts">Serving different hosts</a></li>
<li><a href="#determine-interface-inside-callbacks">Determine interface inside callbacks</a></li>
<li><a href="#bad-responses">Bad Responses</a></li>
<li><a href="#respond-with-content-using-a-callback-without-content-length-to-http10-clients">Respond with content using a callback without content length to HTTP/1.0 clients</a></li>
<li><a href="#async-websocket-plugin">Async WebSocket Plugin</a></li>
<li><a href="#async-websocket-event">Async WebSocket Event</a></li>
<li><a href="#methods-for-sending-data-to-a-socket-client">Methods for sending data to a socket client</a></li>
<li><a href="#direct-access-to-web-socket-message-buffer">Direct access to web socket message buffer</a></li>
<li><a href="#limiting-the-number-of-web-socket-clients">Limiting the number of web socket clients</a></li>
<li><a href="#async-event-source-plugin">Async Event Source Plugin</a></li>
<li><a href="#setup-event-source-on-the-server">Setup Event Source on the server</a></li>
<li><a href="#setup-event-source-in-the-browser">Setup Event Source in the browser</a></li>
<li><a href="#scanning-for-available-wifi-networks">Scanning for available WiFi Networks</a></li>
<li><a href="#remove-handlers-and-rewrites">Remove handlers and rewrites</a></li>
<li><a href="#setting-up-the-server">Setting up the server</a></li>
<li><a href="#setup-global-and-class-functions-as-request-handlers">Setup global and class functions as request handlers</a></li>
<li><a href="#methods-for-controlling-websocket-connections">Methods for controlling websocket connections</a></li>
<li><a href="#adding-default-headers">Adding Default Headers</a></li>
<li><a href="#path-variable">Path variable</a></li>
</ul>
<h3 id="why-should-you-care">Why should you care<a class="headerlink" href="#why-should-you-care" title="Permanent link">&para;</a></h3>
<ul>
<li>Using asynchronous network means that you can handle more than one connection at the same time</li>
<li>You are called once the request is ready and parsed</li>
<li>When you send the response, you are immediately ready to handle other connections
  while the server is taking care of sending the response in the background</li>
<li>Speed is OMG</li>
<li>Easy to use API, HTTP Basic and Digest MD5 Authentication (default), ChunkedResponse</li>
<li>Easily extendible to handle any type of content</li>
<li>Supports Continue 100</li>
<li>Async WebSocket plugin offering different locations without extra servers or ports</li>
<li>Async EventSource (Server-Sent Events) plugin to send events to the browser</li>
<li>URL Rewrite plugin for conditional and permanent url rewrites</li>
<li>ServeStatic plugin that supports cache, Last-Modified, default index and more</li>
<li>Simple template processing engine to handle templates</li>
</ul>
<h3 id="important-things-to-remember">Important things to remember<a class="headerlink" href="#important-things-to-remember" title="Permanent link">&para;</a></h3>
<ul>
<li>This is fully asynchronous server and as such does not run on the loop thread.</li>
<li>You can not use yield or delay or any function that uses them inside the callbacks</li>
<li>The server is smart enough to know when to close the connection and free resources</li>
<li>You can not send more than one response to a single request</li>
</ul>
<h3 id="principles-of-operation">Principles of operation<a class="headerlink" href="#principles-of-operation" title="Permanent link">&para;</a></h3>
<h4 id="the-async-web-server">The Async Web server<a class="headerlink" href="#the-async-web-server" title="Permanent link">&para;</a></h4>
<ul>
<li>Listens for connections</li>
<li>Wraps the new clients into <code>Request</code></li>
<li>Keeps track of clients and cleans memory</li>
<li>Manages <code>Rewrites</code> and apply them on the request url</li>
<li>Manages <code>Handlers</code> and attaches them to Requests</li>
</ul>
<h4 id="request-life-cycle">Request Life Cycle<a class="headerlink" href="#request-life-cycle" title="Permanent link">&para;</a></h4>
<ul>
<li>TCP connection is received by the server</li>
<li>The connection is wrapped inside <code>Request</code> object</li>
<li>When the request head is received (type, url, get params, http version and host),
  the server goes through all <code>Rewrites</code> (in the order they were added) to rewrite the url and inject query parameters,
  next, it goes through all attached <code>Handlers</code>(in the order they were added) trying to find one
  that <code>canHandle</code> the given request. If none are found, the default(catch-all) handler is attached.</li>
<li>The rest of the request is received, calling the <code>handleUpload</code> or <code>handleBody</code> methods of the <code>Handler</code> if they are needed (POST+File/Body)</li>
<li>When the whole request is parsed, the result is given to the <code>handleRequest</code> method of the <code>Handler</code> and is ready to be responded to</li>
<li>In the <code>handleRequest</code> method, to the <code>Request</code> is attached a <code>Response</code> object (see below) that will serve the response data back to the client</li>
<li>When the <code>Response</code> is sent, the client is closed and freed from the memory</li>
</ul>
<h4 id="rewrites-and-how-do-they-work">Rewrites and how do they work<a class="headerlink" href="#rewrites-and-how-do-they-work" title="Permanent link">&para;</a></h4>
<ul>
<li>The <code>Rewrites</code> are used to rewrite the request url and/or inject get parameters for a specific request url path.</li>
<li>All <code>Rewrites</code> are evaluated on the request in the order they have been added to the server.</li>
<li>The <code>Rewrite</code> will change the request url only if the request url (excluding get parameters) is fully match
  the rewrite url, and when the optional <code>Filter</code> callback return true.</li>
<li>Setting a <code>Filter</code> to the <code>Rewrite</code> enables to control when to apply the rewrite, decision can be based on
  request url, http version, request host/port/target host, get parameters or the request client's localIP or remoteIP.</li>
<li>Two filter callbacks are provided: <code>ON_AP_FILTER</code> to execute the rewrite when request is made to the AP interface,
  <code>ON_STA_FILTER</code> to execute the rewrite when request is made to the STA interface.</li>
<li>The <code>Rewrite</code> can specify a target url with optional get parameters, e.g. <code>/to-url?with=params</code></li>
</ul>
<h4 id="handlers-and-how-do-they-work">Handlers and how do they work<a class="headerlink" href="#handlers-and-how-do-they-work" title="Permanent link">&para;</a></h4>
<ul>
<li>The <code>Handlers</code> are used for executing specific actions to particular requests</li>
<li>One <code>Handler</code> instance can be attached to any request and lives together with the server</li>
<li>Setting a <code>Filter</code> to the <code>Handler</code> enables to control when to apply the handler, decision can be based on
  request url, http version, request host/port/target host, get parameters or the request client's localIP or remoteIP.</li>
<li>Two filter callbacks are provided: <code>ON_AP_FILTER</code> to execute the rewrite when request is made to the AP interface,
  <code>ON_STA_FILTER</code> to execute the rewrite when request is made to the STA interface.</li>
<li>The <code>canHandle</code> method is used for handler specific control on whether the requests can be handled
  and for declaring any interesting headers that the <code>Request</code> should parse. Decision can be based on request
  method, request url, http version, request host/port/target host and get parameters</li>
<li>Once a <code>Handler</code> is attached to given <code>Request</code> (<code>canHandle</code> returned true)
  that <code>Handler</code> takes care to receive any file/data upload and attach a <code>Response</code>
  once the <code>Request</code> has been fully parsed</li>
<li><code>Handlers</code> are evaluated in the order they are attached to the server. The <code>canHandle</code> is called only
  if the <code>Filter</code> that was set to the <code>Handler</code> return true.</li>
<li>The first <code>Handler</code> that can handle the request is selected, not further <code>Filter</code> and <code>canHandle</code> are called.</li>
</ul>
<h4 id="responses-and-how-do-they-work">Responses and how do they work<a class="headerlink" href="#responses-and-how-do-they-work" title="Permanent link">&para;</a></h4>
<ul>
<li>The <code>Response</code> objects are used to send the response data back to the client</li>
<li>The <code>Response</code> object lives with the <code>Request</code> and is freed on end or disconnect</li>
<li>Different techniques are used depending on the response type to send the data in packets
  returning back almost immediately and sending the next packet when this one is received.
  Any time in between is spent to run the user loop and handle other network packets</li>
<li>Responding asynchronously is probably the most difficult thing for most to understand</li>
<li>Many different options exist for the user to make responding a background task</li>
</ul>
<h4 id="template-processing">Template processing<a class="headerlink" href="#template-processing" title="Permanent link">&para;</a></h4>
<ul>
<li>ESPAsyncWebserver contains simple template processing engine.</li>
<li>Template processing can be added to most response types.</li>
<li>Currently it supports only replacing template placeholders with actual values. No conditional processing, cycles, etc.</li>
<li>Placeholders are delimited with <code>%</code> symbols. Like this: <code>%TEMPLATE_PLACEHOLDER%</code>.</li>
<li>It works by extracting placeholder name from response text and passing it to user provided function which should return actual value to be used instead of placeholder.</li>
<li>Since it's user provided function, it is possible for library users to implement conditional processing and cycles themselves.</li>
<li>Since it's impossible to know the actual response size after template processing step in advance (and, therefore, to include it in response headers), the response becomes <a href="#chunked-response">chunked</a>.</li>
</ul>
<h3 id="libraries-and-projects-that-use-asyncwebserver">Libraries and projects that use AsyncWebServer<a class="headerlink" href="#libraries-and-projects-that-use-asyncwebserver" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://beelance.carbou.me/">Beelance</a> - Autonomous and remotely connected weight scale for beehives </li>
<li><a href="https://github.com/ayushsharma82/ElegantOTA">ElegantOTA</a> - OTA updates made slick and simple for everyone!</li>
<li><a href="https://github.com/Edzelf/Esp-radio">ESP Radio</a> - Icecast radio based on ESP8266 and VS1053</li>
<li><a href="https://github.com/ayushsharma82/ESP-DASH">ESP-DASH</a> - ESP-DASH is a library for ESP32 Arduino that facilitates the use of a dashboard in an asynchronous way. I have contributed most of the recently newly added fixes and features of the OSS and Pro version</li>
<li><a href="https://github.com/omersiar/esp-rfid">ESP-RFID</a> - MFRC522 RFID Access Control Management project for ESP8266.</li>
<li><a href="https://github.com/xoseperez/espurna">ESPurna</a> - ESPurna ("spark" in Catalan) is a custom C firmware for ESP8266 based smart switches. It was originally developed with the ITead Sonoff in mind.</li>
<li><a href="https://github.com/vintlabs/fauxmoESP">FauxmoESP</a> - Belkin WeMo emulator library for ESP8266.</li>
<li><a href="https://mathieu.carbou.me/MycilaESPConnect">MycilaESPConnect</a> - Simple &amp; Easy Network Manager with Captive Portal for ESP32 supporting Ethernet</li>
<li><a href="https://mathieu.carbou.me/MycilaJSY">MycilaJSY</a> - Arduino / ESP32 library for the JSY1031, JSY-MK-163, JSY-MK-193, JSY-MK-194, JSY-MK-227, JSY-MK-229, JSY-MK-333 families single-phase and three-phase AC bidirectional meters from Shenzhen Jiansiyan Technologies Co, Ltd.</li>
<li><a href="https://mathieu.carbou.me/MycilaWebSerial">MycilaWebSerial</a> - WebSerial is a Serial Monitor for ESP32 that can be accessed remotely via a web browser</li>
<li><a href="https://github.com/ayushsharma82/NetWizard">NetWizard</a> - No need to hard-code WiFi credentials ever again. (ESP32, RP2040+W)</li>
<li><a href="https://github.com/Hopperpop/Sattrack">Sattrack</a> - Track the ISS with ESP8266</li>
<li><a href="https://github.com/andig/vzero">VZero</a> - the Wireless zero-config controller for volkszaehler.org</li>
<li><a href="https://github.com/ayushsharma82/WebSerial">WebSerial</a> - A remote terminal library for wireless microcontrollers to log, monitor or debug your firmware/product</li>
<li><a href="https://github.com/hallard/WebSocketToSerial">WebSocketToSerial</a> - Debug serial devices through the web browser</li>
<li><a href="https://yasolr.carbou.me">YaSlR (Yet another Solar Router)</a> - Heat water with your Solar Production Excess with the more powerful and precise solar diverter out there! |</li>
</ul>
<h3 id="request-variables">Request Variables<a class="headerlink" href="#request-variables" title="Permanent link">&para;</a></h3>
<h4 id="common-variables">Common Variables<a class="headerlink" href="#common-variables" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">();</span><span class="w">       </span><span class="c1">// uint8_t: 0 = HTTP/1.0, 1 = HTTP/1.1</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">method</span><span class="p">();</span><span class="w">        </span><span class="c1">// enum:    HTTP_GET, HTTP_POST, HTTP_DELETE, HTTP_PUT, HTTP_PATCH, HTTP_HEAD, HTTP_OPTIONS</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">();</span><span class="w">           </span><span class="c1">// String:  URL of the request (not including host, port or GET parameters)</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">host</span><span class="p">();</span><span class="w">          </span><span class="c1">// String:  The requested host (can be used for virtual hosting)</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">contentType</span><span class="p">();</span><span class="w">   </span><span class="c1">// String:  ContentType of the request (not available in Handler::canHandle)</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">contentLength</span><span class="p">();</span><span class="w"> </span><span class="c1">// size_t:  ContentLength of the request (not available in Handler::canHandle)</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">multipart</span><span class="p">();</span><span class="w">     </span><span class="c1">// bool:    True if the request has content type &quot;multipart&quot;</span>
</span></code></pre></div>
<h4 id="headers">Headers<a class="headerlink" href="#headers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">//List all collected headers</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">headers</span><span class="p">();</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">headers</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">AsyncWebHeader</span><span class="o">*</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">getHeader</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;HEADER[%s]: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">h</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="p">}</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="c1">//get specific header by name</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">hasHeader</span><span class="p">(</span><span class="s">&quot;MyHeader&quot;</span><span class="p">)){</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">AsyncWebHeader</span><span class="o">*</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">getHeader</span><span class="p">(</span><span class="s">&quot;MyHeader&quot;</span><span class="p">);</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;MyHeader: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="p">}</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="c1">//List all collected headers (Compatibility)</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="kt">int</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">headers</span><span class="p">();</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">headers</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;HEADER[%s]: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">headerName</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="p">}</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="c1">//get specific header by name (Compatibility)</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">hasHeader</span><span class="p">(</span><span class="s">&quot;MyHeader&quot;</span><span class="p">)){</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;MyHeader: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;MyHeader&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="get-post-and-file-parameters">GET, POST and FILE parameters<a class="headerlink" href="#get-post-and-file-parameters" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">//List all parameters</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">();</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">params</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="n">AsyncWebParameter</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">getParam</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">isFile</span><span class="p">()){</span><span class="w"> </span><span class="c1">//p-&gt;isPost() is also true</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;FILE[%s]: %s, size: %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">());</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">isPost</span><span class="p">()){</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;POST[%s]: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;GET[%s]: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="p">}</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="c1">//Check if GET parameter exists</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">hasParam</span><span class="p">(</span><span class="s">&quot;download&quot;</span><span class="p">))</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">  </span><span class="n">AsyncWebParameter</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">getParam</span><span class="p">(</span><span class="s">&quot;download&quot;</span><span class="p">);</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="c1">//Check if POST (but not File) parameter exists</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">hasParam</span><span class="p">(</span><span class="s">&quot;download&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">))</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">  </span><span class="n">AsyncWebParameter</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">getParam</span><span class="p">(</span><span class="s">&quot;download&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="c1">//Check if FILE was uploaded</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">hasParam</span><span class="p">(</span><span class="s">&quot;download&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">))</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">  </span><span class="n">AsyncWebParameter</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">getParam</span><span class="p">(</span><span class="s">&quot;download&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="c1">//List all parameters (Compatibility)</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="kt">int</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">args</span><span class="p">();</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">args</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;ARG[%s]: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">argName</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="p">}</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="c1">//Check if parameter exists (Compatibility)</span>
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">hasArg</span><span class="p">(</span><span class="s">&quot;download&quot;</span><span class="p">))</span>
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">(</span><span class="s">&quot;download&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="file-upload-handling">FILE Upload handling<a class="headerlink" href="#file-upload-handling" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">handleUpload</span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="k">final</span><span class="p">){</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">index</span><span class="p">){</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;UploadStart: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="k">final</span><span class="p">){</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;UploadEnd: %s, %u B</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">index</span><span class="o">+</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="body-data-handling">Body data handling<a class="headerlink" href="#body-data-handling" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">handleBody</span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">total</span><span class="p">){</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">index</span><span class="p">){</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;BodyStart: %u B</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">total</span><span class="p">);</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">total</span><span class="p">){</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;BodyEnd: %u B</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">total</span><span class="p">);</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="p">}</span>
</span></code></pre></div>
<p>If needed, the <code>_tempObject</code> field on the request can be used to store a pointer to temporary data (e.g. from the body) associated with the request. If assigned, the pointer will automatically be freed along with the request.</p>
<h4 id="json-body-handling-with-arduinojson">JSON body handling with ArduinoJson<a class="headerlink" href="#json-body-handling-with-arduinojson" title="Permanent link">&para;</a></h4>
<p>Endpoints which consume JSON can use a special handler to get ready to use JSON data in the request callback:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AsyncJson.h&quot;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ArduinoJson.h&quot;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">AsyncCallbackJsonWebHandler</span><span class="o">*</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AsyncCallbackJsonWebHandler</span><span class="p">(</span><span class="s">&quot;/rest/endpoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">JsonVariant</span><span class="w"> </span><span class="o">&amp;</span><span class="n">json</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">  </span><span class="n">JsonObject</span><span class="w"> </span><span class="n">jsonObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="n">as</span><span class="o">&lt;</span><span class="n">JsonObject</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">  </span><span class="c1">// ...</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="p">});</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="n">server</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="responses">Responses<a class="headerlink" href="#responses" title="Permanent link">&para;</a></h3>
<h4 id="redirect-to-another-url">Redirect to another URL<a class="headerlink" href="#redirect-to-another-url" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">//to local url</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">redirect</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">);</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c1">//to external url</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">redirect</span><span class="p">(</span><span class="s">&quot;http://esp8266.com&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="basic-response-with-http-code">Basic response with HTTP Code<a class="headerlink" href="#basic-response-with-http-code" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span><span class="w"> </span><span class="c1">//Sends 404 File Not Found</span>
</span></code></pre></div>
<h4 id="basic-response-with-http-code-and-extra-headers">Basic response with HTTP Code and extra headers<a class="headerlink" href="#basic-response-with-http-code-and-extra-headers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span><span class="w"> </span><span class="c1">//Sends 404 File Not Found</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="basic-response-with-string-content">Basic response with string content<a class="headerlink" href="#basic-response-with-string-content" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello World!&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="basic-response-with-string-content-and-extra-headers">Basic response with string content and extra headers<a class="headerlink" href="#basic-response-with-string-content-and-extra-headers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello World!&quot;</span><span class="p">);</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="send-large-webpage-from-progmem">Send large webpage from PROGMEM<a class="headerlink" href="#send-large-webpage-from-progmem" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">index_html</span><span class="p">[]</span><span class="w"> </span><span class="n">PROGMEM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// large char array, tested with 14k</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send_P</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/html&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">index_html</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="send-large-webpage-from-progmem-and-extra-headers">Send large webpage from PROGMEM and extra headers<a class="headerlink" href="#send-large-webpage-from-progmem-and-extra-headers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">index_html</span><span class="p">[]</span><span class="w"> </span><span class="n">PROGMEM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// large char array, tested with 14k</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse_P</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/html&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">index_html</span><span class="p">);</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="send-large-webpage-from-progmem-containing-templates">Send large webpage from PROGMEM containing templates<a class="headerlink" href="#send-large-webpage-from-progmem-containing-templates" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">String</span><span class="w"> </span><span class="nf">processor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">var</span><span class="p">)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="p">{</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">var</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;HELLO_FROM_TEMPLATE&quot;</span><span class="p">)</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">);</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">();</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="p">}</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="c1">// ...</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">index_html</span><span class="p">[]</span><span class="w"> </span><span class="n">PROGMEM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// large char array, tested with 14k</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send_P</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/html&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">index_html</span><span class="p">,</span><span class="w"> </span><span class="n">processor</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="send-large-webpage-from-progmem-containing-templates-and-extra-headers">Send large webpage from PROGMEM containing templates and extra headers<a class="headerlink" href="#send-large-webpage-from-progmem-containing-templates-and-extra-headers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">String</span><span class="w"> </span><span class="nf">processor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">var</span><span class="p">)</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="p">{</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">var</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;HELLO_FROM_TEMPLATE&quot;</span><span class="p">)</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">);</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">();</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="p">}</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="c1">// ...</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">index_html</span><span class="p">[]</span><span class="w"> </span><span class="n">PROGMEM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// large char array, tested with 14k</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse_P</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/html&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">index_html</span><span class="p">,</span><span class="w"> </span><span class="n">processor</span><span class="p">);</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="send-binary-content-from-progmem">Send binary content from PROGMEM<a class="headerlink" href="#send-binary-content-from-progmem" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1">//File: favicon.ico.gz, Size: 726</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="cp">#define favicon_ico_gz_len 726</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">favicon_ico_gz</span><span class="p">[]</span><span class="w"> </span><span class="n">PROGMEM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w"> </span><span class="mh">0x1F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x87</span><span class="p">,</span><span class="w"> </span><span class="mh">0x90</span><span class="p">,</span><span class="w"> </span><span class="mh">0x57</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x03</span><span class="p">,</span><span class="w"> </span><span class="mh">0x66</span><span class="p">,</span><span class="w"> </span><span class="mh">0x61</span><span class="p">,</span><span class="w"> </span><span class="mh">0x76</span><span class="p">,</span><span class="w"> </span><span class="mh">0x69</span><span class="p">,</span><span class="w"> </span><span class="mh">0x63</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6F</span><span class="p">,</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w"> </span><span class="mh">0x6E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x69</span><span class="p">,</span><span class="w"> </span><span class="mh">0x63</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0xCD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x53</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x48</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x51</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x62</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6D</span><span class="p">,</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w"> </span><span class="mh">0x86</span><span class="p">,</span><span class="w"> </span><span class="mh">0x96</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x64</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x99</span><span class="p">,</span><span class="w"> </span><span class="mh">0x65</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1A</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB4</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8A</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x51</span><span class="p">,</span><span class="w"> </span><span class="mh">0x54</span><span class="p">,</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w"> </span><span class="mh">0xA8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x11</span><span class="p">,</span><span class="w"> </span><span class="mh">0x49</span><span class="p">,</span><span class="w"> </span><span class="mh">0x51</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x34</span><span class="p">,</span><span class="w"> </span><span class="mh">0x62</span><span class="p">,</span><span class="w"> </span><span class="mh">0x93</span><span class="p">,</span><span class="w"> </span><span class="mh">0x85</span><span class="p">,</span><span class="w"> </span><span class="mh">0x31</span><span class="p">,</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span><span class="w"> </span><span class="mh">0x44</span><span class="p">,</span><span class="w"> </span><span class="mh">0x12</span><span class="p">,</span><span class="w"> </span><span class="mh">0x45</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w"> </span><span class="mh">0xF5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x52</span><span class="p">,</span><span class="w"> </span><span class="mh">0x41</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">,</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span><span class="w"> </span><span class="mh">0x82</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="mh">0x98</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2F</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x26</span><span class="p">,</span><span class="w"> </span><span class="mh">0xED</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="mh">0x89</span><span class="p">,</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="w"> </span><span class="mh">0x04</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD7</span><span class="p">,</span><span class="w"> </span><span class="mh">0x83</span><span class="p">,</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="mh">0x28</span><span class="p">,</span><span class="w"> </span><span class="mh">0x04</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8C</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE5</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC3</span><span class="p">,</span><span class="w"> </span><span class="mh">0x60</span><span class="p">,</span><span class="w"> </span><span class="mh">0x32</span><span class="p">,</span><span class="w"> </span><span class="mh">0x64</span><span class="p">,</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="w"> </span><span class="mh">0x0E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9D</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x30</span><span class="p">,</span><span class="w"> </span><span class="mh">0x82</span><span class="p">,</span><span class="w"> </span><span class="mh">0xED</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x87</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8F</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8F</span><span class="p">,</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="w"> </span><span class="mh">0x73</span><span class="p">,</span><span class="w"> </span><span class="mh">0xCF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9C</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x39</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFB</span><span class="p">,</span><span class="w"> </span><span class="mh">0x31</span><span class="p">,</span><span class="w"> </span><span class="mh">0x26</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">,</span><span class="w"> </span><span class="mh">0x37</span><span class="p">,</span><span class="w"> </span><span class="mh">0x97</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5B</span><span class="p">,</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w"> </span><span class="mh">0xCF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x67</span><span class="p">,</span><span class="w"> </span><span class="mh">0x30</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x66</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x99</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC9</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x45</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x74</span><span class="p">,</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w"> </span><span class="mh">0xA6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x94</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5E</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB2</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF9</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x96</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD8</span><span class="p">,</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="w"> </span><span class="mh">0xD8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x78</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDA</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDC</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDC</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2C</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xED</span><span class="p">,</span><span class="w"> </span><span class="mh">0xED</span><span class="p">,</span><span class="w"> </span><span class="mh">0x15</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9B</span><span class="p">,</span><span class="w"> </span><span class="mh">0xCD</span><span class="p">,</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w"> </span><span class="mh">0xE6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x83</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x29</span><span class="p">,</span><span class="w"> </span><span class="mh">0x29</span><span class="p">,</span><span class="w"> </span><span class="mh">0x99</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6A</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x75</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9D</span><span class="p">,</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="w"> </span><span class="mh">0x61</span><span class="p">,</span><span class="w"> </span><span class="mh">0x75</span><span class="p">,</span><span class="w"> </span><span class="mh">0x75</span><span class="p">,</span><span class="w"> </span><span class="mh">0x95</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB5</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD4</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD4</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF4</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBA</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBA</span><span class="p">,</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="w"> </span><span class="mh">0xFA</span><span class="p">,</span><span class="w"> </span><span class="mh">0x83</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6A</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x28</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4B</span><span class="p">,</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="w"> </span><span class="mh">0x98</span><span class="p">,</span><span class="w"> </span><span class="mh">0x78</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5E</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x95</span><span class="p">,</span><span class="w"> </span><span class="mh">0x42</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x40</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4E</span><span class="p">,</span><span class="w"> </span><span class="mh">0xCE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x65</span><span class="p">,</span><span class="w"> </span><span class="mh">0x76</span><span class="p">,</span><span class="w"> </span><span class="mh">0x76</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF6</span><span class="p">,</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x26</span><span class="p">,</span><span class="w"> </span><span class="mh">0x93</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA2</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x69</span><span class="p">,</span><span class="w"> </span><span class="mh">0x69</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD1</span><span class="p">,</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="w"> </span><span class="mh">0x11</span><span class="p">,</span><span class="w"> </span><span class="mh">0x36</span><span class="p">,</span><span class="w"> </span><span class="mh">0x62</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span><span class="w"> </span><span class="mh">0x60</span><span class="p">,</span><span class="w"> </span><span class="mh">0x32</span><span class="p">,</span><span class="w"> </span><span class="mh">0x99</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEB</span><span class="p">,</span><span class="w"> </span><span class="mh">0x51</span><span class="p">,</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFC</span><span class="p">,</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="w"> </span><span class="mh">0xFC</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">,</span><span class="w"> </span><span class="mh">0x16</span><span class="p">,</span><span class="w"> </span><span class="mh">0x02</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x97</span><span class="p">,</span><span class="w"> </span><span class="mh">0x43</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x95</span><span class="p">,</span><span class="w"> </span><span class="mh">0x42</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x16</span><span class="p">,</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x52</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x64</span><span class="p">,</span><span class="w"> </span><span class="mh">0x65</span><span class="p">,</span><span class="w"> </span><span class="mh">0x65</span><span class="p">,</span><span class="w"> </span><span class="mh">0x71</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7D</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x93</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEA</span><span class="p">,</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="w"> </span><span class="mh">0xFE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x30</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8D</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEC</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEC</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC4</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE2</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x22</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x40</span><span class="p">,</span><span class="w"> </span><span class="mh">0x39</span><span class="p">,</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a><span class="w"> </span><span class="mh">0x41</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x38</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4E</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x87</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x54</span><span class="p">,</span><span class="w"> </span><span class="mh">0x54</span><span class="p">,</span><span class="w"> </span><span class="mh">0x54</span><span class="p">,</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a><span class="w"> </span><span class="mh">0xBC</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE9</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEB</span><span class="p">,</span><span class="w"> </span><span class="mh">0x93</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x30</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2B</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA2</span><span class="p">,</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="w"> </span><span class="mh">0x3E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x41</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x21</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x63</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x81</span><span class="p">,</span><span class="w"> </span><span class="mh">0x40</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x94</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3D</span><span class="p">,</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="w"> </span><span class="mh">0x3D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x42</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x96</span><span class="p">,</span><span class="w"> </span><span class="mh">0x96</span><span class="p">,</span><span class="w"> </span><span class="mh">0x96</span><span class="p">,</span><span class="w"> </span><span class="mh">0x70</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8E</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE3</span><span class="p">,</span><span class="w"> </span><span class="mh">0x63</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFD</span><span class="p">,</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a><span class="w"> </span><span class="mh">0xFE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB4</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x68</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x05</span><span class="p">,</span><span class="w"> </span><span class="mh">0xCE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB4</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE3</span><span class="p">,</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="w"> </span><span class="mh">0xE8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD9</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x19</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x36</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1B</span><span class="p">,</span>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="w"> </span><span class="mh">0x36</span><span class="p">,</span><span class="w"> </span><span class="mh">0x36</span><span class="p">,</span><span class="w"> </span><span class="mh">0x36</span><span class="p">,</span><span class="w"> </span><span class="mh">0x38</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x85</span><span class="p">,</span><span class="w"> </span><span class="mh">0x85</span><span class="p">,</span><span class="w"> </span><span class="mh">0x05</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAC</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x22</span><span class="p">,</span><span class="w"> </span><span class="mh">0x91</span><span class="p">,</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="w"> </span><span class="mh">0x48</span><span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="mh">0x16</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8B</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFD</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDA</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDA</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDA</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x41</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x57</span><span class="p">,</span><span class="w"> </span><span class="mh">0x50</span><span class="p">,</span><span class="w"> </span><span class="mh">0x50</span><span class="p">,</span><span class="w"> </span><span class="mh">0x80</span><span class="p">,</span>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="w"> </span><span class="mh">0x89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x09</span><span class="p">,</span><span class="w"> </span><span class="mh">0x84</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC3</span><span class="p">,</span><span class="w"> </span><span class="mh">0x61</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span><span class="w"> </span><span class="mh">0x12</span><span class="p">,</span><span class="w"> </span><span class="mh">0x89</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span>
</span><span id="__span-30-33"><a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="w"> </span><span class="mh">0x43</span><span class="p">,</span><span class="w"> </span><span class="mh">0x43</span><span class="p">,</span><span class="w"> </span><span class="mh">0x43</span><span class="p">,</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5E</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x46</span><span class="p">,</span><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0x79</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBE</span><span class="p">,</span>
</span><span id="__span-30-34"><a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a><span class="w"> </span><span class="mh">0xBD</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3D</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x06</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC7</span><span class="p">,</span><span class="w"> </span><span class="mh">0x84</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4F</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF7</span><span class="p">,</span>
</span><span id="__span-30-35"><a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a><span class="w"> </span><span class="mh">0xF7</span><span class="p">,</span><span class="w"> </span><span class="mh">0x63</span><span class="p">,</span><span class="w"> </span><span class="mh">0x60</span><span class="p">,</span><span class="w"> </span><span class="mh">0x60</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x83</span><span class="p">,</span><span class="w"> </span><span class="mh">0x83</span><span class="p">,</span><span class="w"> </span><span class="mh">0x83</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">,</span><span class="w"> </span><span class="mh">0x19</span><span class="p">,</span><span class="w"> </span><span class="mh">0x19</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDC</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDC</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8F</span><span class="p">,</span>
</span><span id="__span-30-36"><a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a><span class="w"> </span><span class="mh">0x17</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7C</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA4</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE7</span><span class="p">,</span><span class="w"> </span><span class="mh">0x34</span><span class="p">,</span><span class="w"> </span><span class="mh">0x39</span><span class="p">,</span><span class="w"> </span><span class="mh">0x39</span><span class="p">,</span><span class="w"> </span><span class="mh">0x89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x54</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE3</span><span class="p">,</span><span class="w"> </span><span class="mh">0x13</span><span class="p">,</span>
</span><span id="__span-30-37"><a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a><span class="w"> </span><span class="mh">0xE5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x34</span><span class="p">,</span><span class="w"> </span><span class="mh">0x11</span><span class="p">,</span><span class="w"> </span><span class="mh">0x37</span><span class="p">,</span><span class="w"> </span><span class="mh">0x49</span><span class="p">,</span><span class="w"> </span><span class="mh">0x51</span><span class="p">,</span><span class="w"> </span><span class="mh">0x51</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4B</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x52</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x45</span><span class="p">,</span><span class="w"> </span><span class="mh">0x26</span><span class="p">,</span><span class="w"> </span><span class="mh">0x93</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5D</span><span class="p">,</span>
</span><span id="__span-30-38"><a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a><span class="w"> </span><span class="mh">0x0A</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF3</span><span class="p">,</span><span class="w"> </span><span class="mh">0x92</span><span class="p">,</span><span class="w"> </span><span class="mh">0x48</span><span class="p">,</span><span class="w"> </span><span class="mh">0x24</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">,</span><span class="w"> </span><span class="mh">0x17</span><span class="p">,</span><span class="w"> </span><span class="mh">0x17</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x16</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5D</span><span class="p">,</span>
</span><span id="__span-30-39"><a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a><span class="w"> </span><span class="mh">0x5D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1E</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBB</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9C</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x21</span><span class="p">,</span><span class="w"> </span><span class="mh">0x42</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6B</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD2</span><span class="p">,</span>
</span><span id="__span-30-40"><a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a><span class="w"> </span><span class="mh">0x45</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="mh">0x12</span><span class="p">,</span><span class="w"> </span><span class="mh">0x34</span><span class="p">,</span><span class="w"> </span><span class="mh">0xCC</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x19</span><span class="p">,</span><span class="w"> </span><span class="mh">0x54</span><span class="p">,</span><span class="w"> </span><span class="mh">0x92</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0E</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD2</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x43</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF8</span><span class="p">,</span>
</span><span id="__span-30-41"><a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a><span class="w"> </span><span class="mh">0xCF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x82</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC2</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDC</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEA</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEA</span><span class="p">,</span><span class="w"> </span><span class="mh">0x38</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4C</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9D</span><span class="p">,</span>
</span><span id="__span-30-42"><a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a><span class="w"> </span><span class="mh">0xB8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFA</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6E</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0x55</span><span class="p">,</span>
</span><span id="__span-30-43"><a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a><span class="w"> </span><span class="mh">0x55</span><span class="p">,</span><span class="w"> </span><span class="mh">0x55</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x66</span><span class="p">,</span><span class="w"> </span><span class="mh">0x66</span><span class="p">,</span><span class="w"> </span><span class="mh">0x46</span><span class="p">,</span><span class="w"> </span><span class="mh">0x44</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDA</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x34</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x94</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x09</span><span class="p">,</span>
</span><span id="__span-30-44"><a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a><span class="w"> </span><span class="mh">0x7B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x45</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBD</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x57</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x73</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD9</span><span class="p">,</span><span class="w"> </span><span class="mh">0xED</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x84</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span>
</span><span id="__span-30-45"><a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a><span class="w"> </span><span class="mh">0xE7</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7D</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x95</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4A</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6D</span><span class="p">,</span><span class="w"> </span><span class="mh">0x77</span><span class="p">,</span><span class="w"> </span><span class="mh">0x77</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xCD</span><span class="p">,</span>
</span><span id="__span-30-46"><a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a><span class="w"> </span><span class="mh">0xE9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x74</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x73</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3C</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8F</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF4</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF4</span><span class="p">,</span><span class="w"> </span><span class="mh">0x94</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAD</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAD</span><span class="p">,</span>
</span><span id="__span-30-47"><a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a><span class="w"> </span><span class="mh">0xAD</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDD</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xCF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x73</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0B</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0B</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5D</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x66</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC5</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE4</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">,</span>
</span><span id="__span-30-48"><a id="__codelineno-30-48" name="__codelineno-30-48" href="#__codelineno-30-48"></a><span class="w"> </span><span class="mh">0x4C</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF4</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xD8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x59</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7F</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xB4</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFC</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0F</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x37</span><span class="p">,</span><span class="w"> </span><span class="mh">0x70</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEC</span><span class="p">,</span>
</span><span id="__span-30-49"><a id="__codelineno-30-49" name="__codelineno-30-49" href="#__codelineno-30-49"></a><span class="w"> </span><span class="mh">0x16</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4A</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7E</span><span class="p">,</span><span class="w"> </span><span class="mh">0x04</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span>
</span><span id="__span-30-50"><a id="__codelineno-30-50" name="__codelineno-30-50" href="#__codelineno-30-50"></a><span class="p">};</span>
</span><span id="__span-30-51"><a id="__codelineno-30-51" name="__codelineno-30-51" href="#__codelineno-30-51"></a>
</span><span id="__span-30-52"><a id="__codelineno-30-52" name="__codelineno-30-52" href="#__codelineno-30-52"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse_P</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;image/x-icon&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">favicon_ico_gz</span><span class="p">,</span><span class="w"> </span><span class="n">favicon_ico_gz_len</span><span class="p">);</span>
</span><span id="__span-30-53"><a id="__codelineno-30-53" name="__codelineno-30-53" href="#__codelineno-30-53"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Content-Encoding&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gzip&quot;</span><span class="p">);</span>
</span><span id="__span-30-54"><a id="__codelineno-30-54" name="__codelineno-30-54" href="#__codelineno-30-54"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-content-coming-from-a-stream">Respond with content coming from a Stream<a class="headerlink" href="#respond-with-content-coming-from-a-stream" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1">//read 12 bytes from Serial and send them as Content Type text/plain</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">Serial</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-content-coming-from-a-stream-and-extra-headers">Respond with content coming from a Stream and extra headers<a class="headerlink" href="#respond-with-content-coming-from-a-stream-and-extra-headers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1">//read 12 bytes from Serial and send them as Content Type text/plain</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span><span class="n">Serial</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">);</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-content-coming-from-a-stream-containing-templates">Respond with content coming from a Stream containing templates<a class="headerlink" href="#respond-with-content-coming-from-a-stream-containing-templates" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">String</span><span class="w"> </span><span class="nf">processor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">var</span><span class="p">)</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="p">{</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">var</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;HELLO_FROM_TEMPLATE&quot;</span><span class="p">)</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">);</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">();</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="p">}</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="c1">// ...</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="c1">//read 12 bytes from Serial and send them as Content Type text/plain</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">Serial</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="n">processor</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-content-coming-from-a-stream-containing-templates-and-extra-headers">Respond with content coming from a Stream containing templates and extra headers<a class="headerlink" href="#respond-with-content-coming-from-a-stream-containing-templates-and-extra-headers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">String</span><span class="w"> </span><span class="nf">processor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">var</span><span class="p">)</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="p">{</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">var</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;HELLO_FROM_TEMPLATE&quot;</span><span class="p">)</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">);</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">();</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="p">}</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="c1">// ...</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="c1">//read 12 bytes from Serial and send them as Content Type text/plain</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span><span class="n">Serial</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="n">processor</span><span class="p">);</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-content-coming-from-a-file">Respond with content coming from a File<a class="headerlink" href="#respond-with-content-coming-from-a-file" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1">//Send index.htm with default content type</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/index.htm&quot;</span><span class="p">);</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="c1">//Send index.htm as text</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/index.htm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">);</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="c1">//Download index.htm</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/index.htm&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">(),</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-content-coming-from-a-file-and-extra-headers">Respond with content coming from a File and extra headers<a class="headerlink" href="#respond-with-content-coming-from-a-file-and-extra-headers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1">//Send index.htm with default content type</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/index.htm&quot;</span><span class="p">);</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="c1">//Send index.htm as text</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/index.htm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">);</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="c1">//Download index.htm</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/index.htm&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">(),</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-content-coming-from-a-file-containing-templates">Respond with content coming from a File containing templates<a class="headerlink" href="#respond-with-content-coming-from-a-file-containing-templates" title="Permanent link">&para;</a></h4>
<p>Internally uses <a href="#chunked-response">Chunked Response</a>.</p>
<p>Index.htm contents:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>%HELLO_FROM_TEMPLATE%
</span></code></pre></div>
<p>Somewhere in source files:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">String</span><span class="w"> </span><span class="nf">processor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">var</span><span class="p">)</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="p">{</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">var</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;HELLO_FROM_TEMPLATE&quot;</span><span class="p">)</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">);</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">();</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="p">}</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="c1">// ...</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="c1">//Send index.htm with template processor function</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/index.htm&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">(),</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">processor</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-content-using-a-callback">Respond with content using a callback<a class="headerlink" href="#respond-with-content-using-a-callback" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1">//send 128 bytes as plain text</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxLen</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">  </span><span class="c1">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">  </span><span class="c1">//index equals the amount of bytes that have been already sent</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">  </span><span class="c1">//You will not be asked for more bytes once the content length has been reached.</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">  </span><span class="c1">//Keep in mind that you can not delay or yield waiting for more data!</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">  </span><span class="c1">//Send what you currently have and you will be asked for more again</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">mySource</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">maxLen</span><span class="p">);</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="p">});</span>
</span></code></pre></div>
<h4 id="respond-with-content-using-a-callback-and-extra-headers">Respond with content using a callback and extra headers<a class="headerlink" href="#respond-with-content-using-a-callback-and-extra-headers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">//send 128 bytes as plain text</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxLen</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">  </span><span class="c1">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">  </span><span class="c1">//index equals the amount of bytes that have been already sent</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">  </span><span class="c1">//You will not be asked for more bytes once the content length has been reached.</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">  </span><span class="c1">//Keep in mind that you can not delay or yield waiting for more data!</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">  </span><span class="c1">//Send what you currently have and you will be asked for more again</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">mySource</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">maxLen</span><span class="p">);</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="p">});</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-file-content-using-a-callback-and-extra-headers">Respond with file content using a callback and extra headers<a class="headerlink" href="#respond-with-file-content-using-a-callback-and-extra-headers" title="Permanent link">&para;</a></h4>
<p>With this code your ESP is able to serve even large (large in terms of ESP, e.g. 100kB) files
without memory problems.</p>
<p>You need to create a file handler in outer function (to have a single one for request) but use
it in a lambda. The catch is that the lambda has it's own lifecycle which may/will cause it's
called after the original function is over thus the original file handle is destroyed. Using the
captured <code>&amp;file</code> in the lambda then causes segfault (Hello, Exception 9!) and the whole ESP crashes.
By using this code, you tell the compiler to move the handle into the lambda so it won't be
destroyed when outer function (that one where you call <code>request-&gt;send(response)</code>) ends.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="k">const</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="c1">// e.g. SPIFFS.open(path, &quot;r&quot;);</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="k">const</span><span class="w"> </span><span class="n">contentType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;application/javascript&quot;</span><span class="p">;</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">  </span><span class="n">contentType</span><span class="p">,</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">  </span><span class="n">file</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">  </span><span class="p">[</span><span class="n">file</span><span class="p">](</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxLen</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">total</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">     </span><span class="kt">int</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">maxLen</span><span class="p">);</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">     </span><span class="c1">// close file at the end</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bytes</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">bytes</span><span class="p">);</span><span class="w"> </span><span class="c1">// return 0 even when no bytes were loaded</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">   </span><span class="p">}</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="p">);</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gzipped</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">  </span><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Content-Encoding&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;gzip&quot;</span><span class="p">));</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="p">}</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-content-using-a-callback-containing-templates">Respond with content using a callback containing templates<a class="headerlink" href="#respond-with-content-using-a-callback-containing-templates" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">String</span><span class="w"> </span><span class="nf">processor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">var</span><span class="p">)</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="p">{</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">var</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;HELLO_FROM_TEMPLATE&quot;</span><span class="p">)</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">);</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">();</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="p">}</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="c1">// ...</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="c1">//send 128 bytes as plain text</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxLen</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="w">  </span><span class="c1">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="w">  </span><span class="c1">//index equals the amount of bytes that have been already sent</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="w">  </span><span class="c1">//You will not be asked for more bytes once the content length has been reached.</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="w">  </span><span class="c1">//Keep in mind that you can not delay or yield waiting for more data!</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="w">  </span><span class="c1">//Send what you currently have and you will be asked for more again</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">mySource</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">maxLen</span><span class="p">);</span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="p">},</span><span class="w"> </span><span class="n">processor</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="respond-with-content-using-a-callback-containing-templates-and-extra-headers">Respond with content using a callback containing templates and extra headers<a class="headerlink" href="#respond-with-content-using-a-callback-containing-templates-and-extra-headers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">String</span><span class="w"> </span><span class="nf">processor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">var</span><span class="p">)</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="p">{</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">var</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;HELLO_FROM_TEMPLATE&quot;</span><span class="p">)</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">);</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">();</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="p">}</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="c1">// ...</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="c1">//send 128 bytes as plain text</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxLen</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="w">  </span><span class="c1">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="w">  </span><span class="c1">//index equals the amount of bytes that have been already sent</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="w">  </span><span class="c1">//You will not be asked for more bytes once the content length has been reached.</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="w">  </span><span class="c1">//Keep in mind that you can not delay or yield waiting for more data!</span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="w">  </span><span class="c1">//Send what you currently have and you will be asked for more again</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">mySource</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">maxLen</span><span class="p">);</span>
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="p">},</span><span class="w"> </span><span class="n">processor</span><span class="p">);</span>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="chunked-response">Chunked Response<a class="headerlink" href="#chunked-response" title="Permanent link">&para;</a></h4>
<p>Used when content length is unknown. Works best if the client supports HTTP/1.1</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginChunkedResponse</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxLen</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">  </span><span class="c1">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">  </span><span class="c1">//index equals the amount of bytes that have been already sent</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">  </span><span class="c1">//You will be asked for more data until 0 is returned</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">  </span><span class="c1">//Keep in mind that you can not delay or yield waiting for more data!</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">mySource</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">maxLen</span><span class="p">);</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="p">});</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="chunked-response-containing-templates">Chunked Response containing templates<a class="headerlink" href="#chunked-response-containing-templates" title="Permanent link">&para;</a></h4>
<p>Used when content length is unknown. Works best if the client supports HTTP/1.1</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">String</span><span class="w"> </span><span class="nf">processor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">var</span><span class="p">)</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="p">{</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">var</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;HELLO_FROM_TEMPLATE&quot;</span><span class="p">)</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">);</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">();</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="p">}</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="c1">// ...</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginChunkedResponse</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxLen</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">  </span><span class="c1">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="w">  </span><span class="c1">//index equals the amount of bytes that have been already sent</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="w">  </span><span class="c1">//You will be asked for more data until 0 is returned</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="w">  </span><span class="c1">//Keep in mind that you can not delay or yield waiting for more data!</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">mySource</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">maxLen</span><span class="p">);</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="p">},</span><span class="w"> </span><span class="n">processor</span><span class="p">);</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="print-to-response">Print to response<a class="headerlink" href="#print-to-response" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">AsyncResponseStream</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponseStream</span><span class="p">(</span><span class="s">&quot;text/html&quot;</span><span class="p">);</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Webpage at %s&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;h2&gt;Hello &quot;</span><span class="p">);</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">client</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">remoteIP</span><span class="p">());</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;/h2&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;h3&gt;General&lt;/h3&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;ul&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;Version: HTTP/1.%u&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">());</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;Method: %s&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">methodToString</span><span class="p">());</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;URL: %s&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;Host: %s&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">host</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;ContentType: %s&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">contentType</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;ContentLength: %u&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">contentLength</span><span class="p">());</span>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;Multipart: %s&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">multipart</span><span class="p">()</span><span class="o">?</span><span class="s">&quot;true&quot;</span><span class="o">:</span><span class="s">&quot;false&quot;</span><span class="p">);</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;/ul&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a>
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;h3&gt;Headers&lt;/h3&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;ul&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-22"><a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a><span class="kt">int</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">headers</span><span class="p">();</span>
</span><span id="__span-46-23"><a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">headers</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-46-24"><a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a><span class="w">  </span><span class="n">AsyncWebHeader</span><span class="o">*</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">getHeader</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-46-25"><a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a><span class="w">  </span><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;%s: %s&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">h</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-46-26"><a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a><span class="p">}</span>
</span><span id="__span-46-27"><a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;/ul&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-28"><a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a>
</span><span id="__span-46-29"><a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;h3&gt;Parameters&lt;/h3&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-30"><a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;ul&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-31"><a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a><span class="kt">int</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">();</span>
</span><span id="__span-46-32"><a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">params</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-46-33"><a id="__codelineno-46-33" name="__codelineno-46-33" href="#__codelineno-46-33"></a><span class="w">  </span><span class="n">AsyncWebParameter</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">getParam</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-46-34"><a id="__codelineno-46-34" name="__codelineno-46-34" href="#__codelineno-46-34"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">isFile</span><span class="p">()){</span>
</span><span id="__span-46-35"><a id="__codelineno-46-35" name="__codelineno-46-35" href="#__codelineno-46-35"></a><span class="w">    </span><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;FILE[%s]: %s, size: %u&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">());</span>
</span><span id="__span-46-36"><a id="__codelineno-46-36" name="__codelineno-46-36" href="#__codelineno-46-36"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">isPost</span><span class="p">()){</span>
</span><span id="__span-46-37"><a id="__codelineno-46-37" name="__codelineno-46-37" href="#__codelineno-46-37"></a><span class="w">    </span><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;POST[%s]: %s&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-46-38"><a id="__codelineno-46-38" name="__codelineno-46-38" href="#__codelineno-46-38"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-39"><a id="__codelineno-46-39" name="__codelineno-46-39" href="#__codelineno-46-39"></a><span class="w">    </span><span class="n">response</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;GET[%s]: %s&lt;/li&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-46-40"><a id="__codelineno-46-40" name="__codelineno-46-40" href="#__codelineno-46-40"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-46-41"><a id="__codelineno-46-41" name="__codelineno-46-41" href="#__codelineno-46-41"></a><span class="p">}</span>
</span><span id="__span-46-42"><a id="__codelineno-46-42" name="__codelineno-46-42" href="#__codelineno-46-42"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;/ul&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-43"><a id="__codelineno-46-43" name="__codelineno-46-43" href="#__codelineno-46-43"></a>
</span><span id="__span-46-44"><a id="__codelineno-46-44" name="__codelineno-46-44" href="#__codelineno-46-44"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-46-45"><a id="__codelineno-46-45" name="__codelineno-46-45" href="#__codelineno-46-45"></a><span class="c1">//send the response last</span>
</span><span id="__span-46-46"><a id="__codelineno-46-46" name="__codelineno-46-46" href="#__codelineno-46-46"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="arduinojson-basic-response">ArduinoJson Basic Response<a class="headerlink" href="#arduinojson-basic-response" title="Permanent link">&para;</a></h4>
<p>This way of sending Json is great for when the result is below 4KB</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AsyncJson.h&quot;</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ArduinoJson.h&quot;</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="n">AsyncResponseStream</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponseStream</span><span class="p">(</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="n">DynamicJsonBuffer</span><span class="w"> </span><span class="n">jsonBuffer</span><span class="p">;</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="n">JsonObject</span><span class="w"> </span><span class="o">&amp;</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonBuffer</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="n">root</span><span class="p">[</span><span class="s">&quot;heap&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP</span><span class="p">.</span><span class="n">getFreeHeap</span><span class="p">();</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="n">root</span><span class="p">[</span><span class="s">&quot;ssid&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WiFi</span><span class="p">.</span><span class="n">SSID</span><span class="p">();</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="n">root</span><span class="p">.</span><span class="n">printTo</span><span class="p">(</span><span class="o">*</span><span class="n">response</span><span class="p">);</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="arduinojson-advanced-response">ArduinoJson Advanced Response<a class="headerlink" href="#arduinojson-advanced-response" title="Permanent link">&para;</a></h4>
<p>This response can handle really large Json objects (tested to 40KB)
There isn't any noticeable speed decrease for small results with the method above
Since ArduinoJson does not allow reading parts of the string, the whole Json has to
be passed every time a chunks needs to be sent, which shows speed decrease proportional
to the resulting json packets</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AsyncJson.h&quot;</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ArduinoJson.h&quot;</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="n">AsyncJsonResponse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AsyncJsonResponse</span><span class="p">();</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">,</span><span class="s">&quot;ESP Async Web Server&quot;</span><span class="p">);</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="n">JsonObject</span><span class="o">&amp;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="o">-&gt;</span><span class="n">getRoot</span><span class="p">();</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="n">root</span><span class="p">[</span><span class="s">&quot;heap&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP</span><span class="p">.</span><span class="n">getFreeHeap</span><span class="p">();</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="n">root</span><span class="p">[</span><span class="s">&quot;ssid&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WiFi</span><span class="p">.</span><span class="n">SSID</span><span class="p">();</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="n">response</span><span class="o">-&gt;</span><span class="n">setLength</span><span class="p">();</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="serving-static-files">Serving static files<a class="headerlink" href="#serving-static-files" title="Permanent link">&para;</a></h3>
<p>In addition to serving files from SPIFFS as described above, the server provide a dedicated handler that optimize the
performance of serving files from SPIFFS - <code>AsyncStaticWebHandler</code>. Use <code>server.serveStatic()</code> function to
initialize and add a new instance of <code>AsyncStaticWebHandler</code> to the server.
The Handler will not handle the request if the file does not exists, e.g. the server will continue to look for another
handler that can handle the request.
Notice that you can chain setter functions to setup the handler, or keep a pointer to change it at a later time.</p>
<h4 id="serving-specific-file-by-name">Serving specific file by name<a class="headerlink" href="#serving-specific-file-by-name" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1">// Serve the file &quot;/www/page.htm&quot; when request url is &quot;/page.htm&quot;</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/page.htm&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/page.htm&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="serving-files-in-directory">Serving files in directory<a class="headerlink" href="#serving-files-in-directory" title="Permanent link">&para;</a></h4>
<p>To serve files in a directory, the path to the files should specify a directory in SPIFFS and ends with "/".</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1">// Serve files in directory &quot;/www/&quot; when request url starts with &quot;/&quot;</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="c1">// Request to the root or none existing files will try to server the default</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="c1">// file name &quot;index.htm&quot; if exists</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">);</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="c1">// Server with different default file</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">).</span><span class="n">setDefaultFile</span><span class="p">(</span><span class="s">&quot;default.html&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="serving-static-files-with-authentication">Serving static files with authentication<a class="headerlink" href="#serving-static-files-with-authentication" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">server</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">    </span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">)</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">    </span><span class="p">.</span><span class="n">setDefaultFile</span><span class="p">(</span><span class="s">&quot;default.html&quot;</span><span class="p">)</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">    </span><span class="p">.</span><span class="n">setAuthentication</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pass&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="specifying-cache-control-header">Specifying Cache-Control header<a class="headerlink" href="#specifying-cache-control-header" title="Permanent link">&para;</a></h4>
<p>It is possible to specify Cache-Control header value to reduce the number of calls to the server once the client loaded
the files. For more information on Cache-Control values see <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9">Cache-Control</a></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1">// Cache responses for 10 minutes (600 seconds)</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">).</span><span class="n">setCacheControl</span><span class="p">(</span><span class="s">&quot;max-age=600&quot;</span><span class="p">);</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="c1">//*** Change Cache-Control after server setup ***</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="c1">// During setup - keep a pointer to the handler</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="n">AsyncStaticWebHandler</span><span class="o">*</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">).</span><span class="n">setCacheControl</span><span class="p">(</span><span class="s">&quot;max-age=600&quot;</span><span class="p">);</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="c1">// At a later event - change Cache-Control</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="n">handler</span><span class="o">-&gt;</span><span class="n">setCacheControl</span><span class="p">(</span><span class="s">&quot;max-age=30&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="specifying-date-modified-header">Specifying Date-Modified header<a class="headerlink" href="#specifying-date-modified-header" title="Permanent link">&para;</a></h4>
<p>It is possible to specify Date-Modified header to enable the server to return Not-Modified (304) response for requests
with "If-Modified-Since" header with the same value, instead of responding with the actual file content.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1">// Update the date modified string every time files are updated</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">).</span><span class="n">setLastModified</span><span class="p">(</span><span class="s">&quot;Mon, 20 Jun 2016 14:00:00 GMT&quot;</span><span class="p">);</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="c1">//*** Change last modified value at a later stage ***</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="c1">// During setup - read last modified value from config or EEPROM</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="n">String</span><span class="w"> </span><span class="n">date_modified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadDateModified</span><span class="p">();</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="n">AsyncStaticWebHandler</span><span class="o">*</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">);</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="n">handler</span><span class="o">-&gt;</span><span class="n">setLastModified</span><span class="p">(</span><span class="n">date_modified</span><span class="p">);</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="c1">// At a later event when files are updated</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="n">String</span><span class="w"> </span><span class="n">date_modified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getNewDateModfied</span><span class="p">();</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="n">saveDateModified</span><span class="p">(</span><span class="n">date_modified</span><span class="p">);</span><span class="w"> </span><span class="c1">// Save for next reset</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="n">handler</span><span class="o">-&gt;</span><span class="n">setLastModified</span><span class="p">(</span><span class="n">date_modified</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="specifying-template-processor-callback">Specifying Template Processor callback<a class="headerlink" href="#specifying-template-processor-callback" title="Permanent link">&para;</a></h4>
<p>It is possible to specify template processor for static files. For information on template processor see
<a href="#respond-with-content-coming-from-a-file-containing-templates">Respond with content coming from a File containing templates</a>.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="n">String</span><span class="w"> </span><span class="nf">processor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">var</span><span class="p">)</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="p">{</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">var</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;HELLO_FROM_TEMPLATE&quot;</span><span class="p">)</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">);</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">String</span><span class="p">();</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="p">}</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="c1">// ...</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">).</span><span class="n">setTemplateProcessor</span><span class="p">(</span><span class="n">processor</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="serving-static-files-by-custom-handling">Serving static files by custom handling<a class="headerlink" href="#serving-static-files-by-custom-handling" title="Permanent link">&para;</a></h4>
<p>It may happen your static files are too big and the ESP will crash the request before it sends the whole file.
In that case, you can handle static files with custom file serving through not found handler.</p>
<p>This code below is more-or-less equivalent to this:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">webServer</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="n">STATIC_FILES_PREFIX</span><span class="p">).</span><span class="n">setDefaultFile</span><span class="p">(</span><span class="s">&quot;index.html&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>First, declare the handling function:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">handleStaticFile</span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STATIC_FILES_PREFIX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">();</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">endsWith</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">))</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">&quot;index.html&quot;</span><span class="p">);</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">contentType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getContentType</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">pathWithGz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.gz&quot;</span><span class="p">;</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SPIFFS</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pathWithGz</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">gzipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SPIFFS</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pathWithGz</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="w">        </span><span class="n">gzipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="w">        </span><span class="n">path</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;.gz&quot;</span><span class="p">;</span>
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-56-15"><a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>
</span><span id="__span-56-16"><a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a><span class="w">    </span><span class="c1">// TODO serve the file</span>
</span><span id="__span-56-17"><a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a>
</span><span id="__span-56-18"><a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-56-19"><a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-56-20"><a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a>
</span><span id="__span-56-21"><a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-56-22"><a id="__codelineno-56-22" name="__codelineno-56-22" href="#__codelineno-56-22"></a><span class="p">}</span>
</span></code></pre></div>
<p>And then configure your webserver:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="n">webServer</span><span class="p">.</span><span class="n">onNotFound</span><span class="p">([](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">handleStaticFile</span><span class="p">(</span><span class="n">request</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">  </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="p">});</span>
</span></code></pre></div>
<p>You may want to try <a href="#respond-with-file-content-using-a-callback-and-extra-headers">Respond with file content using a callback and extra headers</a>
For actual serving the file.</p>
<h3 id="param-rewrite-with-matching">Param Rewrite With Matching<a class="headerlink" href="#param-rewrite-with-matching" title="Permanent link">&para;</a></h3>
<p>It is possible to rewrite the request url with parameter match. Here is an example with one parameter:
Rewrite for example "/radio/{frequence}" -&gt; "/radio?f={frequence}"</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">OneParamRewrite</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">AsyncWebRewrite</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="p">{</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">  </span><span class="k">protected</span><span class="o">:</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">_urlPrefix</span><span class="p">;</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">_paramIndex</span><span class="p">;</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">_paramsBackup</span><span class="p">;</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="w">  </span><span class="k">public</span><span class="o">:</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="w">  </span><span class="n">OneParamRewrite</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">to</span><span class="p">)</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">AsyncWebRewrite</span><span class="p">(</span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="w">      </span><span class="n">_paramIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_from</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="sc">&#39;{&#39;</span><span class="p">);</span>
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a>
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">_paramIndex</span><span class="w"> </span><span class="o">&gt;=</span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">_from</span><span class="p">.</span><span class="n">endsWith</span><span class="p">(</span><span class="s">&quot;}&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a><span class="w">        </span><span class="n">_urlPrefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_from</span><span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">_paramIndex</span><span class="p">);</span>
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_params</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="sc">&#39;{&#39;</span><span class="p">);</span>
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a><span class="w">          </span><span class="n">_params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_params</span><span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">);</span>
</span><span id="__span-58-19"><a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-58-20"><a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-21"><a id="__codelineno-58-21" name="__codelineno-58-21" href="#__codelineno-58-21"></a><span class="w">        </span><span class="n">_urlPrefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_from</span><span class="p">;</span>
</span><span id="__span-58-22"><a id="__codelineno-58-22" name="__codelineno-58-22" href="#__codelineno-58-22"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-58-23"><a id="__codelineno-58-23" name="__codelineno-58-23" href="#__codelineno-58-23"></a><span class="w">      </span><span class="n">_paramsBackup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_params</span><span class="p">;</span>
</span><span id="__span-58-24"><a id="__codelineno-58-24" name="__codelineno-58-24" href="#__codelineno-58-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-58-25"><a id="__codelineno-58-25" name="__codelineno-58-25" href="#__codelineno-58-25"></a>
</span><span id="__span-58-26"><a id="__codelineno-58-26" name="__codelineno-58-26" href="#__codelineno-58-26"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">match</span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-27"><a id="__codelineno-58-27" name="__codelineno-58-27" href="#__codelineno-58-27"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">().</span><span class="n">startsWith</span><span class="p">(</span><span class="n">_urlPrefix</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-28"><a id="__codelineno-58-28" name="__codelineno-58-28" href="#__codelineno-58-28"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">_paramIndex</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-29"><a id="__codelineno-58-29" name="__codelineno-58-29" href="#__codelineno-58-29"></a><span class="w">        </span><span class="n">_params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_paramsBackup</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">().</span><span class="n">substring</span><span class="p">(</span><span class="n">_paramIndex</span><span class="p">);</span>
</span><span id="__span-58-30"><a id="__codelineno-58-30" name="__codelineno-58-30" href="#__codelineno-58-30"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-31"><a id="__codelineno-58-31" name="__codelineno-58-31" href="#__codelineno-58-31"></a><span class="w">        </span><span class="n">_params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_paramsBackup</span><span class="p">;</span>
</span><span id="__span-58-32"><a id="__codelineno-58-32" name="__codelineno-58-32" href="#__codelineno-58-32"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-58-33"><a id="__codelineno-58-33" name="__codelineno-58-33" href="#__codelineno-58-33"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-58-34"><a id="__codelineno-58-34" name="__codelineno-58-34" href="#__codelineno-58-34"></a>
</span><span id="__span-58-35"><a id="__codelineno-58-35" name="__codelineno-58-35" href="#__codelineno-58-35"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-36"><a id="__codelineno-58-36" name="__codelineno-58-36" href="#__codelineno-58-36"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-58-37"><a id="__codelineno-58-37" name="__codelineno-58-37" href="#__codelineno-58-37"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-58-38"><a id="__codelineno-58-38" name="__codelineno-58-38" href="#__codelineno-58-38"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-58-39"><a id="__codelineno-58-39" name="__codelineno-58-39" href="#__codelineno-58-39"></a><span class="p">};</span>
</span></code></pre></div>
<p>Usage:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">addRewrite</span><span class="p">(</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OneParamRewrite</span><span class="p">(</span><span class="s">&quot;/radio/{frequence}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/radio?f={frequence}&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<h3 id="using-filters">Using filters<a class="headerlink" href="#using-filters" title="Permanent link">&para;</a></h3>
<p>Filters can be set to <code>Rewrite</code> or <code>Handler</code> in order to control when to apply the rewrite and consider the handler.
A filter is a callback function that evaluates the request and return a boolean <code>true</code> to include the item
or <code>false</code> to exclude it.
Two filter callback are provided for convince:</p>
<ul>
<li><code>ON_STA_FILTER</code> - return true when requests are made to the STA (station mode) interface.</li>
<li><code>ON_AP_FILTER</code> - return true when requests are made to the AP (access point) interface.</li>
</ul>
<h4 id="serve-different-site-files-in-ap-mode">Serve different site files in AP mode<a class="headerlink" href="#serve-different-site-files-in-ap-mode" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">).</span><span class="n">setFilter</span><span class="p">(</span><span class="n">ON_STA_FILTER</span><span class="p">);</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/ap/&quot;</span><span class="p">).</span><span class="n">setFilter</span><span class="p">(</span><span class="n">ON_AP_FILTER</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="rewrite-to-different-index-on-ap">Rewrite to different index on AP<a class="headerlink" href="#rewrite-to-different-index-on-ap" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="c1">// Serve the file &quot;/www/index-ap.htm&quot; in AP, and the file &quot;/www/index.htm&quot; on STA</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="n">server</span><span class="p">.</span><span class="n">rewrite</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;index.htm&quot;</span><span class="p">);</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="n">server</span><span class="p">.</span><span class="n">rewrite</span><span class="p">(</span><span class="s">&quot;/index.htm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;index-ap.htm&quot;</span><span class="p">).</span><span class="n">setFilter</span><span class="p">(</span><span class="n">ON_AP_FILTER</span><span class="p">);</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="serving-different-hosts">Serving different hosts<a class="headerlink" href="#serving-different-hosts" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1">// Filter callback using request host</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">filterOnHost1</span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">host</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;host1&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="c1">// Server setup: server files in &quot;/host1/&quot; to requests for &quot;host1&quot;, and files in &quot;/www/&quot; otherwise.</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/host1/&quot;</span><span class="p">).</span><span class="n">setFilter</span><span class="p">(</span><span class="n">filterOnHost1</span><span class="p">);</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/www/&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="determine-interface-inside-callbacks">Determine interface inside callbacks<a class="headerlink" href="#determine-interface-inside-callbacks" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">RedirectUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://&quot;</span><span class="p">;</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ON_STA_FILTER</span><span class="p">(</span><span class="n">request</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="w">    </span><span class="n">RedirectUrl</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">().</span><span class="n">toString</span><span class="p">();</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w">    </span><span class="n">RedirectUrl</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">WiFi</span><span class="p">.</span><span class="n">softAPIP</span><span class="p">().</span><span class="n">toString</span><span class="p">();</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="w">  </span><span class="n">RedirectUrl</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;/index.htm&quot;</span><span class="p">;</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="w">  </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">redirect</span><span class="p">(</span><span class="n">RedirectUrl</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="bad-responses">Bad Responses<a class="headerlink" href="#bad-responses" title="Permanent link">&para;</a></h3>
<p>Some responses are implemented, but you should not use them, because they do not conform to HTTP.
The following example will lead to unclean close of the connection and more time wasted
than providing the length of the content</p>
<h4 id="respond-with-content-using-a-callback-without-content-length-to-http10-clients">Respond with content using a callback without content length to HTTP/1.0 clients<a class="headerlink" href="#respond-with-content-using-a-callback-without-content-length-to-http10-clients" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="c1">//This is used as fallback for chunked responses to HTTP/1.0 Clients</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxLen</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="w">  </span><span class="c1">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="w">  </span><span class="c1">//You will be asked for more data until 0 is returned</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w">  </span><span class="c1">//Keep in mind that you can not delay or yield waiting for more data!</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">mySource</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">maxLen</span><span class="p">);</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="p">});</span>
</span></code></pre></div>
<h3 id="async-websocket-plugin">Async WebSocket Plugin<a class="headerlink" href="#async-websocket-plugin" title="Permanent link">&para;</a></h3>
<p>The server includes a web socket plugin which lets you define different WebSocket locations to connect to
without starting another listening service or using different port</p>
<h4 id="async-websocket-event">Async WebSocket Event<a class="headerlink" href="#async-websocket-event" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">onEvent</span><span class="p">(</span><span class="n">AsyncWebSocket</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">AsyncWebSocketClient</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">AwsEventType</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">){</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_EVT_CONNECT</span><span class="p">){</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="w">    </span><span class="c1">//client connected</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w">    </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;ws[%s][%u] connect</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">(),</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">());</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="w">    </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello Client %u :)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">());</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w">    </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">ping</span><span class="p">();</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_EVT_DISCONNECT</span><span class="p">){</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="w">    </span><span class="c1">//client disconnected</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="w">    </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;ws[%s][%u] disconnect: %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">(),</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">());</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_EVT_ERROR</span><span class="p">){</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="w">    </span><span class="c1">//error was received from the other end</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="w">    </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;ws[%s][%u] error(%u): %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">(),</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">((</span><span class="kt">uint16_t</span><span class="o">*</span><span class="p">)</span><span class="n">arg</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_EVT_PONG</span><span class="p">){</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="w">    </span><span class="c1">//pong message was received (in response to a ping request maybe)</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="w">    </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;ws[%s][%u] pong[%u]: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">(),</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">)</span><span class="o">?</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_EVT_DATA</span><span class="p">){</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="w">    </span><span class="c1">//data packet</span>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="w">    </span><span class="n">AwsFrameInfo</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">AwsFrameInfo</span><span class="o">*</span><span class="p">)</span><span class="n">arg</span><span class="p">;</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="k">final</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">len</span><span class="p">){</span>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="w">      </span><span class="c1">//the whole message is in a single frame and we got all of it&#39;s data</span>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="w">      </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;ws[%s][%u] %s-message[%llu]: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">(),</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_TEXT</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;text&quot;</span><span class="o">:</span><span class="s">&quot;binary&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_TEXT</span><span class="p">){</span>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="n">len</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a><span class="w">        </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a><span class="w">          </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;%02x &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-65-29"><a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a><span class="w">        </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-65-30"><a id="__codelineno-65-30" name="__codelineno-65-30" href="#__codelineno-65-30"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-65-31"><a id="__codelineno-65-31" name="__codelineno-65-31" href="#__codelineno-65-31"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_TEXT</span><span class="p">)</span>
</span><span id="__span-65-32"><a id="__codelineno-65-32" name="__codelineno-65-32" href="#__codelineno-65-32"></a><span class="w">        </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;I got your text message&quot;</span><span class="p">);</span>
</span><span id="__span-65-33"><a id="__codelineno-65-33" name="__codelineno-65-33" href="#__codelineno-65-33"></a><span class="w">      </span><span class="k">else</span>
</span><span id="__span-65-34"><a id="__codelineno-65-34" name="__codelineno-65-34" href="#__codelineno-65-34"></a><span class="w">        </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;I got your binary message&quot;</span><span class="p">);</span>
</span><span id="__span-65-35"><a id="__codelineno-65-35" name="__codelineno-65-35" href="#__codelineno-65-35"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-36"><a id="__codelineno-65-36" name="__codelineno-65-36" href="#__codelineno-65-36"></a><span class="w">      </span><span class="c1">//message is comprised of multiple frames or the frame is split into multiple packets</span>
</span><span id="__span-65-37"><a id="__codelineno-65-37" name="__codelineno-65-37" href="#__codelineno-65-37"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
</span><span id="__span-65-38"><a id="__codelineno-65-38" name="__codelineno-65-38" href="#__codelineno-65-38"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">num</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-65-39"><a id="__codelineno-65-39" name="__codelineno-65-39" href="#__codelineno-65-39"></a><span class="w">          </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;ws[%s][%u] %s-message start</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">(),</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">message_opcode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_TEXT</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;text&quot;</span><span class="o">:</span><span class="s">&quot;binary&quot;</span><span class="p">);</span>
</span><span id="__span-65-40"><a id="__codelineno-65-40" name="__codelineno-65-40" href="#__codelineno-65-40"></a><span class="w">        </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;ws[%s][%u] frame[%u] start[%llu]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">(),</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-65-41"><a id="__codelineno-65-41" name="__codelineno-65-41" href="#__codelineno-65-41"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-65-42"><a id="__codelineno-65-42" name="__codelineno-65-42" href="#__codelineno-65-42"></a>
</span><span id="__span-65-43"><a id="__codelineno-65-43" name="__codelineno-65-43" href="#__codelineno-65-43"></a><span class="w">      </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;ws[%s][%u] frame[%u] %s[%llu - %llu]: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">(),</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">message_opcode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_TEXT</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;text&quot;</span><span class="o">:</span><span class="s">&quot;binary&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-65-44"><a id="__codelineno-65-44" name="__codelineno-65-44" href="#__codelineno-65-44"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">message_opcode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_TEXT</span><span class="p">){</span>
</span><span id="__span-65-45"><a id="__codelineno-65-45" name="__codelineno-65-45" href="#__codelineno-65-45"></a><span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="n">len</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-65-46"><a id="__codelineno-65-46" name="__codelineno-65-46" href="#__codelineno-65-46"></a><span class="w">        </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-65-47"><a id="__codelineno-65-47" name="__codelineno-65-47" href="#__codelineno-65-47"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-48"><a id="__codelineno-65-48" name="__codelineno-65-48" href="#__codelineno-65-48"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-65-49"><a id="__codelineno-65-49" name="__codelineno-65-49" href="#__codelineno-65-49"></a><span class="w">          </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;%02x &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-65-50"><a id="__codelineno-65-50" name="__codelineno-65-50" href="#__codelineno-65-50"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-65-51"><a id="__codelineno-65-51" name="__codelineno-65-51" href="#__codelineno-65-51"></a><span class="w">        </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-65-52"><a id="__codelineno-65-52" name="__codelineno-65-52" href="#__codelineno-65-52"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-65-53"><a id="__codelineno-65-53" name="__codelineno-65-53" href="#__codelineno-65-53"></a>
</span><span id="__span-65-54"><a id="__codelineno-65-54" name="__codelineno-65-54" href="#__codelineno-65-54"></a><span class="w">      </span><span class="k">if</span><span class="p">((</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">){</span>
</span><span id="__span-65-55"><a id="__codelineno-65-55" name="__codelineno-65-55" href="#__codelineno-65-55"></a><span class="w">        </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;ws[%s][%u] frame[%u] end[%llu]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">(),</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-65-56"><a id="__codelineno-65-56" name="__codelineno-65-56" href="#__codelineno-65-56"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="k">final</span><span class="p">){</span>
</span><span id="__span-65-57"><a id="__codelineno-65-57" name="__codelineno-65-57" href="#__codelineno-65-57"></a><span class="w">          </span><span class="n">os_printf</span><span class="p">(</span><span class="s">&quot;ws[%s][%u] %s-message end</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">(),</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">message_opcode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_TEXT</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;text&quot;</span><span class="o">:</span><span class="s">&quot;binary&quot;</span><span class="p">);</span>
</span><span id="__span-65-58"><a id="__codelineno-65-58" name="__codelineno-65-58" href="#__codelineno-65-58"></a><span class="w">          </span><span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">message_opcode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WS_TEXT</span><span class="p">)</span>
</span><span id="__span-65-59"><a id="__codelineno-65-59" name="__codelineno-65-59" href="#__codelineno-65-59"></a><span class="w">            </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;I got your text message&quot;</span><span class="p">);</span>
</span><span id="__span-65-60"><a id="__codelineno-65-60" name="__codelineno-65-60" href="#__codelineno-65-60"></a><span class="w">          </span><span class="k">else</span>
</span><span id="__span-65-61"><a id="__codelineno-65-61" name="__codelineno-65-61" href="#__codelineno-65-61"></a><span class="w">            </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;I got your binary message&quot;</span><span class="p">);</span>
</span><span id="__span-65-62"><a id="__codelineno-65-62" name="__codelineno-65-62" href="#__codelineno-65-62"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-65-63"><a id="__codelineno-65-63" name="__codelineno-65-63" href="#__codelineno-65-63"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-65-64"><a id="__codelineno-65-64" name="__codelineno-65-64" href="#__codelineno-65-64"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-65"><a id="__codelineno-65-65" name="__codelineno-65-65" href="#__codelineno-65-65"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-65-66"><a id="__codelineno-65-66" name="__codelineno-65-66" href="#__codelineno-65-66"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="methods-for-sending-data-to-a-socket-client">Methods for sending data to a socket client<a class="headerlink" href="#methods-for-sending-data-to-a-socket-client" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1">//Server methods</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="n">AsyncWebSocket</span><span class="w"> </span><span class="n">ws</span><span class="p">(</span><span class="s">&quot;/ws&quot;</span><span class="p">);</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="c1">//printf to a client</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="n">ws</span><span class="p">.</span><span class="n">printf</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">client_id</span><span class="p">,</span><span class="w"> </span><span class="n">arguments</span><span class="p">...);</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="c1">//printf to all clients</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="n">ws</span><span class="p">.</span><span class="n">printfAll</span><span class="p">(</span><span class="n">arguments</span><span class="p">...);</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="c1">//printf_P to a client</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="n">ws</span><span class="p">.</span><span class="n">printf_P</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">client_id</span><span class="p">,</span><span class="w"> </span><span class="n">PSTR</span><span class="p">(</span><span class="n">format</span><span class="p">),</span><span class="w"> </span><span class="n">arguments</span><span class="p">...);</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="c1">//printfAll_P to all clients</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="n">ws</span><span class="p">.</span><span class="n">printfAll_P</span><span class="p">(</span><span class="n">PSTR</span><span class="p">(</span><span class="n">format</span><span class="p">),</span><span class="w"> </span><span class="n">arguments</span><span class="p">...);</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="c1">//send text to a client</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="n">ws</span><span class="p">.</span><span class="n">text</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">client_id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">text</span><span class="p">);</span>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="n">ws</span><span class="p">.</span><span class="n">text</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">client_id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="c1">//send text from PROGMEM to a client</span>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a><span class="n">ws</span><span class="p">.</span><span class="n">text</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">client_id</span><span class="p">,</span><span class="w"> </span><span class="n">PSTR</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">));</span>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">flash_text</span><span class="p">[]</span><span class="w"> </span><span class="n">PROGMEM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Text to send&quot;</span>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="n">ws</span><span class="p">.</span><span class="n">text</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">client_id</span><span class="p">,</span><span class="w"> </span><span class="n">FPSTR</span><span class="p">(</span><span class="n">flash_text</span><span class="p">));</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a><span class="c1">//send text to all clients</span>
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a><span class="n">ws</span><span class="p">.</span><span class="n">textAll</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">text</span><span class="p">);</span>
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a><span class="n">ws</span><span class="p">.</span><span class="n">textAll</span><span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-66-21"><a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a><span class="c1">//send binary to a client</span>
</span><span id="__span-66-22"><a id="__codelineno-66-22" name="__codelineno-66-22" href="#__codelineno-66-22"></a><span class="n">ws</span><span class="p">.</span><span class="n">binary</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">client_id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">binary</span><span class="p">);</span>
</span><span id="__span-66-23"><a id="__codelineno-66-23" name="__codelineno-66-23" href="#__codelineno-66-23"></a><span class="n">ws</span><span class="p">.</span><span class="n">binary</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">client_id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">binary</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-66-24"><a id="__codelineno-66-24" name="__codelineno-66-24" href="#__codelineno-66-24"></a><span class="c1">//send binary from PROGMEM to a client</span>
</span><span id="__span-66-25"><a id="__codelineno-66-25" name="__codelineno-66-25" href="#__codelineno-66-25"></a><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">flash_binary</span><span class="p">[]</span><span class="w"> </span><span class="n">PROGMEM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x02</span><span class="p">,</span><span class="w"> </span><span class="mh">0x03</span><span class="p">,</span><span class="w"> </span><span class="mh">0x04</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-66-26"><a id="__codelineno-66-26" name="__codelineno-66-26" href="#__codelineno-66-26"></a><span class="n">ws</span><span class="p">.</span><span class="n">binary</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">client_id</span><span class="p">,</span><span class="w"> </span><span class="n">flash_binary</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
</span><span id="__span-66-27"><a id="__codelineno-66-27" name="__codelineno-66-27" href="#__codelineno-66-27"></a><span class="c1">//send binary to all clients</span>
</span><span id="__span-66-28"><a id="__codelineno-66-28" name="__codelineno-66-28" href="#__codelineno-66-28"></a><span class="n">ws</span><span class="p">.</span><span class="n">binaryAll</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">binary</span><span class="p">);</span>
</span><span id="__span-66-29"><a id="__codelineno-66-29" name="__codelineno-66-29" href="#__codelineno-66-29"></a><span class="n">ws</span><span class="p">.</span><span class="n">binaryAll</span><span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">binary</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-66-30"><a id="__codelineno-66-30" name="__codelineno-66-30" href="#__codelineno-66-30"></a><span class="c1">//HTTP Authenticate before switch to Websocket protocol</span>
</span><span id="__span-66-31"><a id="__codelineno-66-31" name="__codelineno-66-31" href="#__codelineno-66-31"></a><span class="n">ws</span><span class="p">.</span><span class="n">setAuthentication</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pass&quot;</span><span class="p">);</span>
</span><span id="__span-66-32"><a id="__codelineno-66-32" name="__codelineno-66-32" href="#__codelineno-66-32"></a>
</span><span id="__span-66-33"><a id="__codelineno-66-33" name="__codelineno-66-33" href="#__codelineno-66-33"></a><span class="c1">//client methods</span>
</span><span id="__span-66-34"><a id="__codelineno-66-34" name="__codelineno-66-34" href="#__codelineno-66-34"></a><span class="n">AsyncWebSocketClient</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
</span><span id="__span-66-35"><a id="__codelineno-66-35" name="__codelineno-66-35" href="#__codelineno-66-35"></a><span class="c1">//printf</span>
</span><span id="__span-66-36"><a id="__codelineno-66-36" name="__codelineno-66-36" href="#__codelineno-66-36"></a><span class="n">client</span><span class="o">-&gt;</span><span class="n">printf</span><span class="p">(</span><span class="n">arguments</span><span class="p">...);</span>
</span><span id="__span-66-37"><a id="__codelineno-66-37" name="__codelineno-66-37" href="#__codelineno-66-37"></a><span class="c1">//printf_P</span>
</span><span id="__span-66-38"><a id="__codelineno-66-38" name="__codelineno-66-38" href="#__codelineno-66-38"></a><span class="n">client</span><span class="o">-&gt;</span><span class="n">printf_P</span><span class="p">(</span><span class="n">PSTR</span><span class="p">(</span><span class="n">format</span><span class="p">),</span><span class="w"> </span><span class="n">arguments</span><span class="p">...);</span>
</span><span id="__span-66-39"><a id="__codelineno-66-39" name="__codelineno-66-39" href="#__codelineno-66-39"></a><span class="c1">//send text</span>
</span><span id="__span-66-40"><a id="__codelineno-66-40" name="__codelineno-66-40" href="#__codelineno-66-40"></a><span class="n">client</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">text</span><span class="p">);</span>
</span><span id="__span-66-41"><a id="__codelineno-66-41" name="__codelineno-66-41" href="#__codelineno-66-41"></a><span class="n">client</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-66-42"><a id="__codelineno-66-42" name="__codelineno-66-42" href="#__codelineno-66-42"></a><span class="c1">//send text from PROGMEM</span>
</span><span id="__span-66-43"><a id="__codelineno-66-43" name="__codelineno-66-43" href="#__codelineno-66-43"></a><span class="n">client</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">(</span><span class="n">PSTR</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">));</span>
</span><span id="__span-66-44"><a id="__codelineno-66-44" name="__codelineno-66-44" href="#__codelineno-66-44"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">flash_text</span><span class="p">[]</span><span class="w"> </span><span class="n">PROGMEM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Text to send&quot;</span><span class="p">;</span>
</span><span id="__span-66-45"><a id="__codelineno-66-45" name="__codelineno-66-45" href="#__codelineno-66-45"></a><span class="n">client</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">(</span><span class="n">FPSTR</span><span class="p">(</span><span class="n">flash_text</span><span class="p">));</span>
</span><span id="__span-66-46"><a id="__codelineno-66-46" name="__codelineno-66-46" href="#__codelineno-66-46"></a><span class="c1">//send binary</span>
</span><span id="__span-66-47"><a id="__codelineno-66-47" name="__codelineno-66-47" href="#__codelineno-66-47"></a><span class="n">client</span><span class="o">-&gt;</span><span class="n">binary</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">binary</span><span class="p">);</span>
</span><span id="__span-66-48"><a id="__codelineno-66-48" name="__codelineno-66-48" href="#__codelineno-66-48"></a><span class="n">client</span><span class="o">-&gt;</span><span class="n">binary</span><span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">binary</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-66-49"><a id="__codelineno-66-49" name="__codelineno-66-49" href="#__codelineno-66-49"></a><span class="c1">//send binary from PROGMEM</span>
</span><span id="__span-66-50"><a id="__codelineno-66-50" name="__codelineno-66-50" href="#__codelineno-66-50"></a><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">flash_binary</span><span class="p">[]</span><span class="w"> </span><span class="n">PROGMEM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x02</span><span class="p">,</span><span class="w"> </span><span class="mh">0x03</span><span class="p">,</span><span class="w"> </span><span class="mh">0x04</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-66-51"><a id="__codelineno-66-51" name="__codelineno-66-51" href="#__codelineno-66-51"></a><span class="n">client</span><span class="o">-&gt;</span><span class="n">binary</span><span class="p">(</span><span class="n">flash_binary</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="direct-access-to-web-socket-message-buffer">Direct access to web socket message buffer<a class="headerlink" href="#direct-access-to-web-socket-message-buffer" title="Permanent link">&para;</a></h4>
<p>When sending a web socket message using the above methods a buffer is created. Under certain circumstances you might want to manipulate or populate this buffer directly from your application, for example to prevent unnecessary duplications of the data. This example below shows how to create a buffer and print data to it from an ArduinoJson object then send it.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">sendDataWs</span><span class="p">(</span><span class="n">AsyncWebSocketClient</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">client</span><span class="p">)</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="p">{</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w">    </span><span class="n">DynamicJsonBuffer</span><span class="w"> </span><span class="n">jsonBuffer</span><span class="p">;</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="w">    </span><span class="n">JsonObject</span><span class="o">&amp;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonBuffer</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">    </span><span class="n">root</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;abc&quot;</span><span class="p">;</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="w">    </span><span class="n">root</span><span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;abcd&quot;</span><span class="p">;</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w">    </span><span class="n">root</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;abcde&quot;</span><span class="p">;</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="w">    </span><span class="n">root</span><span class="p">[</span><span class="s">&quot;d&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;abcdef&quot;</span><span class="p">;</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="w">    </span><span class="n">root</span><span class="p">[</span><span class="s">&quot;e&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;abcdefg&quot;</span><span class="p">;</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="n">measureLength</span><span class="p">();</span>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="w">    </span><span class="n">AsyncWebSocketMessageBuffer</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ws</span><span class="p">.</span><span class="n">makeBuffer</span><span class="p">(</span><span class="n">len</span><span class="p">);</span><span class="w"> </span><span class="c1">//  creates a buffer (len + 1) for you.</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a><span class="w">        </span><span class="n">root</span><span class="p">.</span><span class="n">printTo</span><span class="p">((</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a><span class="w">            </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a><span class="w">            </span><span class="n">ws</span><span class="p">.</span><span class="n">textAll</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</span><span id="__span-67-18"><a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-67-19"><a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-67-20"><a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="limiting-the-number-of-web-socket-clients">Limiting the number of web socket clients<a class="headerlink" href="#limiting-the-number-of-web-socket-clients" title="Permanent link">&para;</a></h4>
<p>Browsers sometimes do not correctly close the websocket connection, even when the close() function is called in javascript. This will eventually exhaust the web server's resources and will cause the server to crash. Periodically calling the cleanClients() function from the main loop() function limits the number of clients by closing the oldest client when the maximum number of clients has been exceeded. This can called be every cycle, however, if you wish to use less power, then calling as infrequently as once per second is sufficient.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">(){</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">  </span><span class="n">ws</span><span class="p">.</span><span class="n">cleanupClients</span><span class="p">();</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="async-event-source-plugin">Async Event Source Plugin<a class="headerlink" href="#async-event-source-plugin" title="Permanent link">&para;</a></h3>
<p>The server includes EventSource (Server-Sent Events) plugin which can be used to send short text events to the browser.
Difference between EventSource and WebSockets is that EventSource is single direction, text-only protocol.</p>
<h4 id="setup-event-source-on-the-server">Setup Event Source on the server<a class="headerlink" href="#setup-event-source-on-the-server" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="n">AsyncWebServer</span><span class="w"> </span><span class="nf">server</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="n">AsyncEventSource</span><span class="w"> </span><span class="n">events</span><span class="p">(</span><span class="s">&quot;/events&quot;</span><span class="p">);</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">(){</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="w">  </span><span class="c1">// setup ......</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="w">  </span><span class="n">events</span><span class="p">.</span><span class="n">onConnect</span><span class="p">([](</span><span class="n">AsyncEventSourceClient</span><span class="w"> </span><span class="o">*</span><span class="n">client</span><span class="p">){</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">lastId</span><span class="p">()){</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Client reconnected! Last message ID that it gat is: %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">lastId</span><span class="p">());</span>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a><span class="w">    </span><span class="c1">//send event with message &quot;hello!&quot;, id current millis</span>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a><span class="w">    </span><span class="c1">// and set reconnect delay to 1 second</span>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a><span class="w">    </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;hello!&quot;</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">millis</span><span class="p">(),</span><span class="mi">1000</span><span class="p">);</span>
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a><span class="w">  </span><span class="c1">//HTTP Basic authentication</span>
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a><span class="w">  </span><span class="n">events</span><span class="p">.</span><span class="n">setAuthentication</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pass&quot;</span><span class="p">);</span>
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="p">);</span>
</span><span id="__span-69-17"><a id="__codelineno-69-17" name="__codelineno-69-17" href="#__codelineno-69-17"></a><span class="w">  </span><span class="c1">// setup ......</span>
</span><span id="__span-69-18"><a id="__codelineno-69-18" name="__codelineno-69-18" href="#__codelineno-69-18"></a><span class="p">}</span>
</span><span id="__span-69-19"><a id="__codelineno-69-19" name="__codelineno-69-19" href="#__codelineno-69-19"></a>
</span><span id="__span-69-20"><a id="__codelineno-69-20" name="__codelineno-69-20" href="#__codelineno-69-20"></a><span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">(){</span>
</span><span id="__span-69-21"><a id="__codelineno-69-21" name="__codelineno-69-21" href="#__codelineno-69-21"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">eventTriggered</span><span class="p">){</span><span class="w"> </span><span class="c1">// your logic here</span>
</span><span id="__span-69-22"><a id="__codelineno-69-22" name="__codelineno-69-22" href="#__codelineno-69-22"></a><span class="w">    </span><span class="c1">//send event &quot;myevent&quot;</span>
</span><span id="__span-69-23"><a id="__codelineno-69-23" name="__codelineno-69-23" href="#__codelineno-69-23"></a><span class="w">    </span><span class="n">events</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;my event content&quot;</span><span class="p">,</span><span class="s">&quot;myevent&quot;</span><span class="p">,</span><span class="n">millis</span><span class="p">());</span>
</span><span id="__span-69-24"><a id="__codelineno-69-24" name="__codelineno-69-24" href="#__codelineno-69-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-69-25"><a id="__codelineno-69-25" name="__codelineno-69-25" href="#__codelineno-69-25"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="setup-event-source-in-the-browser">Setup Event Source in the browser<a class="headerlink" href="#setup-event-source-in-the-browser" title="Permanent link">&para;</a></h4>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!!</span><span class="nb">window</span><span class="p">.</span><span class="nx">EventSource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">EventSource</span><span class="p">(</span><span class="s2">&quot;/events&quot;</span><span class="p">);</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">  </span><span class="nx">source</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="w">    </span><span class="s2">&quot;open&quot;</span><span class="p">,</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Events Connected&quot;</span><span class="p">);</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="w">    </span><span class="kc">false</span>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-70-11"><a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a>
</span><span id="__span-70-12"><a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a><span class="w">  </span><span class="nx">source</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
</span><span id="__span-70-13"><a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a><span class="w">    </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="__span-70-14"><a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-15"><a id="__codelineno-70-15" name="__codelineno-70-15" href="#__codelineno-70-15"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">EventSource</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-16"><a id="__codelineno-70-16" name="__codelineno-70-16" href="#__codelineno-70-16"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Events Disconnected&quot;</span><span class="p">);</span>
</span><span id="__span-70-17"><a id="__codelineno-70-17" name="__codelineno-70-17" href="#__codelineno-70-17"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-70-18"><a id="__codelineno-70-18" name="__codelineno-70-18" href="#__codelineno-70-18"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-70-19"><a id="__codelineno-70-19" name="__codelineno-70-19" href="#__codelineno-70-19"></a><span class="w">    </span><span class="kc">false</span>
</span><span id="__span-70-20"><a id="__codelineno-70-20" name="__codelineno-70-20" href="#__codelineno-70-20"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-70-21"><a id="__codelineno-70-21" name="__codelineno-70-21" href="#__codelineno-70-21"></a>
</span><span id="__span-70-22"><a id="__codelineno-70-22" name="__codelineno-70-22" href="#__codelineno-70-22"></a><span class="w">  </span><span class="nx">source</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
</span><span id="__span-70-23"><a id="__codelineno-70-23" name="__codelineno-70-23" href="#__codelineno-70-23"></a><span class="w">    </span><span class="s2">&quot;message&quot;</span><span class="p">,</span>
</span><span id="__span-70-24"><a id="__codelineno-70-24" name="__codelineno-70-24" href="#__codelineno-70-24"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-25"><a id="__codelineno-70-25" name="__codelineno-70-25" href="#__codelineno-70-25"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-70-26"><a id="__codelineno-70-26" name="__codelineno-70-26" href="#__codelineno-70-26"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-70-27"><a id="__codelineno-70-27" name="__codelineno-70-27" href="#__codelineno-70-27"></a><span class="w">    </span><span class="kc">false</span>
</span><span id="__span-70-28"><a id="__codelineno-70-28" name="__codelineno-70-28" href="#__codelineno-70-28"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-70-29"><a id="__codelineno-70-29" name="__codelineno-70-29" href="#__codelineno-70-29"></a>
</span><span id="__span-70-30"><a id="__codelineno-70-30" name="__codelineno-70-30" href="#__codelineno-70-30"></a><span class="w">  </span><span class="nx">source</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
</span><span id="__span-70-31"><a id="__codelineno-70-31" name="__codelineno-70-31" href="#__codelineno-70-31"></a><span class="w">    </span><span class="s2">&quot;myevent&quot;</span><span class="p">,</span>
</span><span id="__span-70-32"><a id="__codelineno-70-32" name="__codelineno-70-32" href="#__codelineno-70-32"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-33"><a id="__codelineno-70-33" name="__codelineno-70-33" href="#__codelineno-70-33"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;myevent&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-70-34"><a id="__codelineno-70-34" name="__codelineno-70-34" href="#__codelineno-70-34"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-70-35"><a id="__codelineno-70-35" name="__codelineno-70-35" href="#__codelineno-70-35"></a><span class="w">    </span><span class="kc">false</span>
</span><span id="__span-70-36"><a id="__codelineno-70-36" name="__codelineno-70-36" href="#__codelineno-70-36"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-70-37"><a id="__codelineno-70-37" name="__codelineno-70-37" href="#__codelineno-70-37"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="scanning-for-available-wifi-networks">Scanning for available WiFi Networks<a class="headerlink" href="#scanning-for-available-wifi-networks" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="c1">//First request will return 0 results unless you start scan from somewhere else (loop/setup)</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="c1">//Do not request more often than 3-5 seconds</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/scan&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_GET</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="p">;</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WiFi</span><span class="p">.</span><span class="n">scanComplete</span><span class="p">();</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2</span><span class="p">){</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="w">    </span><span class="n">WiFi</span><span class="p">.</span><span class="n">scanNetworks</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="p">){</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">){</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">;</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a><span class="w">      </span><span class="n">json</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;{&quot;</span><span class="p">;</span>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="w">      </span><span class="n">json</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">rssi</span><span class="se">\&quot;</span><span class="s">:&quot;</span><span class="o">+</span><span class="n">String</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">RSSI</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a><span class="w">      </span><span class="n">json</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,</span><span class="se">\&quot;</span><span class="s">ssid</span><span class="se">\&quot;</span><span class="s">:</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="o">+</span><span class="n">WiFi</span><span class="p">.</span><span class="n">SSID</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a><span class="w">      </span><span class="n">json</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,</span><span class="se">\&quot;</span><span class="s">bssid</span><span class="se">\&quot;</span><span class="s">:</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="o">+</span><span class="n">WiFi</span><span class="p">.</span><span class="n">BSSIDstr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a><span class="w">      </span><span class="n">json</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,</span><span class="se">\&quot;</span><span class="s">channel</span><span class="se">\&quot;</span><span class="s">:&quot;</span><span class="o">+</span><span class="n">String</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">channel</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a><span class="w">      </span><span class="n">json</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,</span><span class="se">\&quot;</span><span class="s">secure</span><span class="se">\&quot;</span><span class="s">:&quot;</span><span class="o">+</span><span class="n">String</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">encryptionType</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a><span class="w">      </span><span class="n">json</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,</span><span class="se">\&quot;</span><span class="s">hidden</span><span class="se">\&quot;</span><span class="s">:&quot;</span><span class="o">+</span><span class="n">String</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">isHidden</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;true&quot;</span><span class="o">:</span><span class="s">&quot;false&quot;</span><span class="p">);</span>
</span><span id="__span-71-18"><a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a><span class="w">      </span><span class="n">json</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;}&quot;</span><span class="p">;</span>
</span><span id="__span-71-19"><a id="__codelineno-71-19" name="__codelineno-71-19" href="#__codelineno-71-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-71-20"><a id="__codelineno-71-20" name="__codelineno-71-20" href="#__codelineno-71-20"></a><span class="w">    </span><span class="n">WiFi</span><span class="p">.</span><span class="n">scanDelete</span><span class="p">();</span>
</span><span id="__span-71-21"><a id="__codelineno-71-21" name="__codelineno-71-21" href="#__codelineno-71-21"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">scanComplete</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2</span><span class="p">){</span>
</span><span id="__span-71-22"><a id="__codelineno-71-22" name="__codelineno-71-22" href="#__codelineno-71-22"></a><span class="w">      </span><span class="n">WiFi</span><span class="p">.</span><span class="n">scanNetworks</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-71-23"><a id="__codelineno-71-23" name="__codelineno-71-23" href="#__codelineno-71-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-71-24"><a id="__codelineno-71-24" name="__codelineno-71-24" href="#__codelineno-71-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-71-25"><a id="__codelineno-71-25" name="__codelineno-71-25" href="#__codelineno-71-25"></a><span class="w">  </span><span class="n">json</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="p">;</span>
</span><span id="__span-71-26"><a id="__codelineno-71-26" name="__codelineno-71-26" href="#__codelineno-71-26"></a><span class="w">  </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">json</span><span class="p">);</span>
</span><span id="__span-71-27"><a id="__codelineno-71-27" name="__codelineno-71-27" href="#__codelineno-71-27"></a><span class="w">  </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">();</span>
</span><span id="__span-71-28"><a id="__codelineno-71-28" name="__codelineno-71-28" href="#__codelineno-71-28"></a><span class="p">});</span>
</span></code></pre></div>
<h3 id="remove-handlers-and-rewrites">Remove handlers and rewrites<a class="headerlink" href="#remove-handlers-and-rewrites" title="Permanent link">&para;</a></h3>
<p>Server goes through handlers in same order as they were added. You can't simple add handler with same path to override them.
To remove handler:</p>
<div class="language-arduino highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="c1">// save callback for particular URL path</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="kr">auto</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/some/path&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">  </span><span class="c1">//do something useful</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="p">});</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="c1">// when you don&#39;t need handler anymore remove it</span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="n">server</span><span class="p">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handler</span><span class="p">);</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="c1">// same with rewrites</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="n">server</span><span class="p">.</span><span class="n">removeRewrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">someRewrite</span><span class="p">);</span>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="n">server</span><span class="p">.</span><span class="n">onNotFound</span><span class="p">([](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){</span>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a><span class="w">  </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</span><span id="__span-72-13"><a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="p">});</span>
</span><span id="__span-72-14"><a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a>
</span><span id="__span-72-15"><a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a><span class="c1">// remove server.onNotFound handler</span>
</span><span id="__span-72-16"><a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a><span class="n">server</span><span class="p">.</span><span class="n">onNotFound</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
</span><span id="__span-72-17"><a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a>
</span><span id="__span-72-18"><a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a><span class="c1">// remove all rewrites, handlers and onNotFound/onFileUpload/onRequestBody callbacks</span>
</span><span id="__span-72-19"><a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a><span class="n">server</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="setting-up-the-server">Setting up the server<a class="headerlink" href="#setting-up-the-server" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ESPAsyncTCP.h&quot;</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ESPAsyncWebServer.h&quot;</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="n">AsyncWebServer</span><span class="w"> </span><span class="nf">server</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="n">AsyncWebSocket</span><span class="w"> </span><span class="n">ws</span><span class="p">(</span><span class="s">&quot;/ws&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// access at ws://[esp ip]/ws</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="n">AsyncEventSource</span><span class="w"> </span><span class="n">events</span><span class="p">(</span><span class="s">&quot;/events&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// event source (Server-Sent events)</span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">ssid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;your-ssid&quot;</span><span class="p">;</span>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;your-pass&quot;</span><span class="p">;</span>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">http_username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;admin&quot;</span><span class="p">;</span>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">http_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;admin&quot;</span><span class="p">;</span>
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a>
</span><span id="__span-73-13"><a id="__codelineno-73-13" name="__codelineno-73-13" href="#__codelineno-73-13"></a><span class="c1">//flag to use from web update to reboot the ESP</span>
</span><span id="__span-73-14"><a id="__codelineno-73-14" name="__codelineno-73-14" href="#__codelineno-73-14"></a><span class="kt">bool</span><span class="w"> </span><span class="n">shouldReboot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-73-15"><a id="__codelineno-73-15" name="__codelineno-73-15" href="#__codelineno-73-15"></a>
</span><span id="__span-73-16"><a id="__codelineno-73-16" name="__codelineno-73-16" href="#__codelineno-73-16"></a><span class="kt">void</span><span class="w"> </span><span class="nf">onRequest</span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){</span>
</span><span id="__span-73-17"><a id="__codelineno-73-17" name="__codelineno-73-17" href="#__codelineno-73-17"></a><span class="w">  </span><span class="c1">//Handle Unknown Request</span>
</span><span id="__span-73-18"><a id="__codelineno-73-18" name="__codelineno-73-18" href="#__codelineno-73-18"></a><span class="w">  </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</span><span id="__span-73-19"><a id="__codelineno-73-19" name="__codelineno-73-19" href="#__codelineno-73-19"></a><span class="p">}</span>
</span><span id="__span-73-20"><a id="__codelineno-73-20" name="__codelineno-73-20" href="#__codelineno-73-20"></a>
</span><span id="__span-73-21"><a id="__codelineno-73-21" name="__codelineno-73-21" href="#__codelineno-73-21"></a><span class="kt">void</span><span class="w"> </span><span class="nf">onBody</span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">total</span><span class="p">){</span>
</span><span id="__span-73-22"><a id="__codelineno-73-22" name="__codelineno-73-22" href="#__codelineno-73-22"></a><span class="w">  </span><span class="c1">//Handle body</span>
</span><span id="__span-73-23"><a id="__codelineno-73-23" name="__codelineno-73-23" href="#__codelineno-73-23"></a><span class="p">}</span>
</span><span id="__span-73-24"><a id="__codelineno-73-24" name="__codelineno-73-24" href="#__codelineno-73-24"></a>
</span><span id="__span-73-25"><a id="__codelineno-73-25" name="__codelineno-73-25" href="#__codelineno-73-25"></a><span class="kt">void</span><span class="w"> </span><span class="nf">onUpload</span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="k">final</span><span class="p">){</span>
</span><span id="__span-73-26"><a id="__codelineno-73-26" name="__codelineno-73-26" href="#__codelineno-73-26"></a><span class="w">  </span><span class="c1">//Handle upload</span>
</span><span id="__span-73-27"><a id="__codelineno-73-27" name="__codelineno-73-27" href="#__codelineno-73-27"></a><span class="p">}</span>
</span><span id="__span-73-28"><a id="__codelineno-73-28" name="__codelineno-73-28" href="#__codelineno-73-28"></a>
</span><span id="__span-73-29"><a id="__codelineno-73-29" name="__codelineno-73-29" href="#__codelineno-73-29"></a><span class="kt">void</span><span class="w"> </span><span class="nf">onEvent</span><span class="p">(</span><span class="n">AsyncWebSocket</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">AsyncWebSocketClient</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">AwsEventType</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">){</span>
</span><span id="__span-73-30"><a id="__codelineno-73-30" name="__codelineno-73-30" href="#__codelineno-73-30"></a><span class="w">  </span><span class="c1">//Handle WebSocket event</span>
</span><span id="__span-73-31"><a id="__codelineno-73-31" name="__codelineno-73-31" href="#__codelineno-73-31"></a><span class="p">}</span>
</span><span id="__span-73-32"><a id="__codelineno-73-32" name="__codelineno-73-32" href="#__codelineno-73-32"></a>
</span><span id="__span-73-33"><a id="__codelineno-73-33" name="__codelineno-73-33" href="#__codelineno-73-33"></a><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">(){</span>
</span><span id="__span-73-34"><a id="__codelineno-73-34" name="__codelineno-73-34" href="#__codelineno-73-34"></a><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span id="__span-73-35"><a id="__codelineno-73-35" name="__codelineno-73-35" href="#__codelineno-73-35"></a><span class="w">  </span><span class="n">WiFi</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="n">WIFI_STA</span><span class="p">);</span>
</span><span id="__span-73-36"><a id="__codelineno-73-36" name="__codelineno-73-36" href="#__codelineno-73-36"></a><span class="w">  </span><span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">ssid</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span>
</span><span id="__span-73-37"><a id="__codelineno-73-37" name="__codelineno-73-37" href="#__codelineno-73-37"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">waitForConnectResult</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WL_CONNECTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-73-38"><a id="__codelineno-73-38" name="__codelineno-73-38" href="#__codelineno-73-38"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;WiFi Failed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-73-39"><a id="__codelineno-73-39" name="__codelineno-73-39" href="#__codelineno-73-39"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-73-40"><a id="__codelineno-73-40" name="__codelineno-73-40" href="#__codelineno-73-40"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-73-41"><a id="__codelineno-73-41" name="__codelineno-73-41" href="#__codelineno-73-41"></a>
</span><span id="__span-73-42"><a id="__codelineno-73-42" name="__codelineno-73-42" href="#__codelineno-73-42"></a><span class="w">  </span><span class="c1">// attach AsyncWebSocket</span>
</span><span id="__span-73-43"><a id="__codelineno-73-43" name="__codelineno-73-43" href="#__codelineno-73-43"></a><span class="w">  </span><span class="n">ws</span><span class="p">.</span><span class="n">onEvent</span><span class="p">(</span><span class="n">onEvent</span><span class="p">);</span>
</span><span id="__span-73-44"><a id="__codelineno-73-44" name="__codelineno-73-44" href="#__codelineno-73-44"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ws</span><span class="p">);</span>
</span><span id="__span-73-45"><a id="__codelineno-73-45" name="__codelineno-73-45" href="#__codelineno-73-45"></a>
</span><span id="__span-73-46"><a id="__codelineno-73-46" name="__codelineno-73-46" href="#__codelineno-73-46"></a><span class="w">  </span><span class="c1">// attach AsyncEventSource</span>
</span><span id="__span-73-47"><a id="__codelineno-73-47" name="__codelineno-73-47" href="#__codelineno-73-47"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="p">);</span>
</span><span id="__span-73-48"><a id="__codelineno-73-48" name="__codelineno-73-48" href="#__codelineno-73-48"></a>
</span><span id="__span-73-49"><a id="__codelineno-73-49" name="__codelineno-73-49" href="#__codelineno-73-49"></a><span class="w">  </span><span class="c1">// respond to GET requests on URL /heap</span>
</span><span id="__span-73-50"><a id="__codelineno-73-50" name="__codelineno-73-50" href="#__codelineno-73-50"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/heap&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_GET</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){</span>
</span><span id="__span-73-51"><a id="__codelineno-73-51" name="__codelineno-73-51" href="#__codelineno-73-51"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">ESP</span><span class="p">.</span><span class="n">getFreeHeap</span><span class="p">()));</span>
</span><span id="__span-73-52"><a id="__codelineno-73-52" name="__codelineno-73-52" href="#__codelineno-73-52"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-73-53"><a id="__codelineno-73-53" name="__codelineno-73-53" href="#__codelineno-73-53"></a>
</span><span id="__span-73-54"><a id="__codelineno-73-54" name="__codelineno-73-54" href="#__codelineno-73-54"></a><span class="w">  </span><span class="c1">// upload a file to /upload</span>
</span><span id="__span-73-55"><a id="__codelineno-73-55" name="__codelineno-73-55" href="#__codelineno-73-55"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/upload&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_POST</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){</span>
</span><span id="__span-73-56"><a id="__codelineno-73-56" name="__codelineno-73-56" href="#__codelineno-73-56"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span id="__span-73-57"><a id="__codelineno-73-57" name="__codelineno-73-57" href="#__codelineno-73-57"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="n">onUpload</span><span class="p">);</span>
</span><span id="__span-73-58"><a id="__codelineno-73-58" name="__codelineno-73-58" href="#__codelineno-73-58"></a>
</span><span id="__span-73-59"><a id="__codelineno-73-59" name="__codelineno-73-59" href="#__codelineno-73-59"></a><span class="w">  </span><span class="c1">// send a file when /index is requested</span>
</span><span id="__span-73-60"><a id="__codelineno-73-60" name="__codelineno-73-60" href="#__codelineno-73-60"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/index&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_ANY</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){</span>
</span><span id="__span-73-61"><a id="__codelineno-73-61" name="__codelineno-73-61" href="#__codelineno-73-61"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/index.htm&quot;</span><span class="p">);</span>
</span><span id="__span-73-62"><a id="__codelineno-73-62" name="__codelineno-73-62" href="#__codelineno-73-62"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-73-63"><a id="__codelineno-73-63" name="__codelineno-73-63" href="#__codelineno-73-63"></a>
</span><span id="__span-73-64"><a id="__codelineno-73-64" name="__codelineno-73-64" href="#__codelineno-73-64"></a><span class="w">  </span><span class="c1">// HTTP basic authentication</span>
</span><span id="__span-73-65"><a id="__codelineno-73-65" name="__codelineno-73-65" href="#__codelineno-73-65"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_GET</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){</span>
</span><span id="__span-73-66"><a id="__codelineno-73-66" name="__codelineno-73-66" href="#__codelineno-73-66"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">authenticate</span><span class="p">(</span><span class="n">http_username</span><span class="p">,</span><span class="w"> </span><span class="n">http_password</span><span class="p">))</span>
</span><span id="__span-73-67"><a id="__codelineno-73-67" name="__codelineno-73-67" href="#__codelineno-73-67"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">requestAuthentication</span><span class="p">();</span>
</span><span id="__span-73-68"><a id="__codelineno-73-68" name="__codelineno-73-68" href="#__codelineno-73-68"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Login Success!&quot;</span><span class="p">);</span>
</span><span id="__span-73-69"><a id="__codelineno-73-69" name="__codelineno-73-69" href="#__codelineno-73-69"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-73-70"><a id="__codelineno-73-70" name="__codelineno-73-70" href="#__codelineno-73-70"></a>
</span><span id="__span-73-71"><a id="__codelineno-73-71" name="__codelineno-73-71" href="#__codelineno-73-71"></a><span class="w">  </span><span class="c1">// Simple Firmware Update Form</span>
</span><span id="__span-73-72"><a id="__codelineno-73-72" name="__codelineno-73-72" href="#__codelineno-73-72"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/update&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_GET</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){</span>
</span><span id="__span-73-73"><a id="__codelineno-73-73" name="__codelineno-73-73" href="#__codelineno-73-73"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/html&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&lt;form method=&#39;POST&#39; action=&#39;/update&#39; enctype=&#39;multipart/form-data&#39;&gt;&lt;input type=&#39;file&#39; name=&#39;update&#39;&gt;&lt;input type=&#39;submit&#39; value=&#39;Update&#39;&gt;&lt;/form&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-73-74"><a id="__codelineno-73-74" name="__codelineno-73-74" href="#__codelineno-73-74"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-73-75"><a id="__codelineno-73-75" name="__codelineno-73-75" href="#__codelineno-73-75"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/update&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_POST</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){</span>
</span><span id="__span-73-76"><a id="__codelineno-73-76" name="__codelineno-73-76" href="#__codelineno-73-76"></a><span class="w">    </span><span class="n">shouldReboot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">Update</span><span class="p">.</span><span class="n">hasError</span><span class="p">();</span>
</span><span id="__span-73-77"><a id="__codelineno-73-77" name="__codelineno-73-77" href="#__codelineno-73-77"></a><span class="w">    </span><span class="n">AsyncWebServerResponse</span><span class="w"> </span><span class="o">*</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">beginResponse</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">shouldReboot</span><span class="o">?</span><span class="s">&quot;OK&quot;</span><span class="o">:</span><span class="s">&quot;FAIL&quot;</span><span class="p">);</span>
</span><span id="__span-73-78"><a id="__codelineno-73-78" name="__codelineno-73-78" href="#__codelineno-73-78"></a><span class="w">    </span><span class="n">response</span><span class="o">-&gt;</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Connection&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;close&quot;</span><span class="p">);</span>
</span><span id="__span-73-79"><a id="__codelineno-73-79" name="__codelineno-73-79" href="#__codelineno-73-79"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</span><span id="__span-73-80"><a id="__codelineno-73-80" name="__codelineno-73-80" href="#__codelineno-73-80"></a><span class="w">  </span><span class="p">},[](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="k">final</span><span class="p">){</span>
</span><span id="__span-73-81"><a id="__codelineno-73-81" name="__codelineno-73-81" href="#__codelineno-73-81"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">index</span><span class="p">){</span>
</span><span id="__span-73-82"><a id="__codelineno-73-82" name="__codelineno-73-82" href="#__codelineno-73-82"></a><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Update Start: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-73-83"><a id="__codelineno-73-83" name="__codelineno-73-83" href="#__codelineno-73-83"></a><span class="w">      </span><span class="n">Update</span><span class="p">.</span><span class="n">runAsync</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-73-84"><a id="__codelineno-73-84" name="__codelineno-73-84" href="#__codelineno-73-84"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">Update</span><span class="p">.</span><span class="n">begin</span><span class="p">((</span><span class="n">ESP</span><span class="p">.</span><span class="n">getFreeSketchSpace</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x1000</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFFFFF000</span><span class="p">)){</span>
</span><span id="__span-73-85"><a id="__codelineno-73-85" name="__codelineno-73-85" href="#__codelineno-73-85"></a><span class="w">        </span><span class="n">Update</span><span class="p">.</span><span class="n">printError</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
</span><span id="__span-73-86"><a id="__codelineno-73-86" name="__codelineno-73-86" href="#__codelineno-73-86"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-73-87"><a id="__codelineno-73-87" name="__codelineno-73-87" href="#__codelineno-73-87"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-73-88"><a id="__codelineno-73-88" name="__codelineno-73-88" href="#__codelineno-73-88"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">Update</span><span class="p">.</span><span class="n">hasError</span><span class="p">()){</span>
</span><span id="__span-73-89"><a id="__codelineno-73-89" name="__codelineno-73-89" href="#__codelineno-73-89"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">Update</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">len</span><span class="p">){</span>
</span><span id="__span-73-90"><a id="__codelineno-73-90" name="__codelineno-73-90" href="#__codelineno-73-90"></a><span class="w">        </span><span class="n">Update</span><span class="p">.</span><span class="n">printError</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
</span><span id="__span-73-91"><a id="__codelineno-73-91" name="__codelineno-73-91" href="#__codelineno-73-91"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-73-92"><a id="__codelineno-73-92" name="__codelineno-73-92" href="#__codelineno-73-92"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-73-93"><a id="__codelineno-73-93" name="__codelineno-73-93" href="#__codelineno-73-93"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="k">final</span><span class="p">){</span>
</span><span id="__span-73-94"><a id="__codelineno-73-94" name="__codelineno-73-94" href="#__codelineno-73-94"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">Update</span><span class="p">.</span><span class="n">end</span><span class="p">(</span><span class="nb">true</span><span class="p">)){</span>
</span><span id="__span-73-95"><a id="__codelineno-73-95" name="__codelineno-73-95" href="#__codelineno-73-95"></a><span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Update Success: %uB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="o">+</span><span class="n">len</span><span class="p">);</span>
</span><span id="__span-73-96"><a id="__codelineno-73-96" name="__codelineno-73-96" href="#__codelineno-73-96"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-73-97"><a id="__codelineno-73-97" name="__codelineno-73-97" href="#__codelineno-73-97"></a><span class="w">        </span><span class="n">Update</span><span class="p">.</span><span class="n">printError</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
</span><span id="__span-73-98"><a id="__codelineno-73-98" name="__codelineno-73-98" href="#__codelineno-73-98"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-73-99"><a id="__codelineno-73-99" name="__codelineno-73-99" href="#__codelineno-73-99"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-73-100"><a id="__codelineno-73-100" name="__codelineno-73-100" href="#__codelineno-73-100"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-73-101"><a id="__codelineno-73-101" name="__codelineno-73-101" href="#__codelineno-73-101"></a>
</span><span id="__span-73-102"><a id="__codelineno-73-102" name="__codelineno-73-102" href="#__codelineno-73-102"></a><span class="w">  </span><span class="c1">// attach filesystem root at URL /fs</span>
</span><span id="__span-73-103"><a id="__codelineno-73-103" name="__codelineno-73-103" href="#__codelineno-73-103"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">serveStatic</span><span class="p">(</span><span class="s">&quot;/fs&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPIFFS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">);</span>
</span><span id="__span-73-104"><a id="__codelineno-73-104" name="__codelineno-73-104" href="#__codelineno-73-104"></a>
</span><span id="__span-73-105"><a id="__codelineno-73-105" name="__codelineno-73-105" href="#__codelineno-73-105"></a><span class="w">  </span><span class="c1">// Catch-All Handlers</span>
</span><span id="__span-73-106"><a id="__codelineno-73-106" name="__codelineno-73-106" href="#__codelineno-73-106"></a><span class="w">  </span><span class="c1">// Any request that can not find a Handler that canHandle it</span>
</span><span id="__span-73-107"><a id="__codelineno-73-107" name="__codelineno-73-107" href="#__codelineno-73-107"></a><span class="w">  </span><span class="c1">// ends in the callbacks below.</span>
</span><span id="__span-73-108"><a id="__codelineno-73-108" name="__codelineno-73-108" href="#__codelineno-73-108"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">onNotFound</span><span class="p">(</span><span class="n">onRequest</span><span class="p">);</span>
</span><span id="__span-73-109"><a id="__codelineno-73-109" name="__codelineno-73-109" href="#__codelineno-73-109"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">onFileUpload</span><span class="p">(</span><span class="n">onUpload</span><span class="p">);</span>
</span><span id="__span-73-110"><a id="__codelineno-73-110" name="__codelineno-73-110" href="#__codelineno-73-110"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">onRequestBody</span><span class="p">(</span><span class="n">onBody</span><span class="p">);</span>
</span><span id="__span-73-111"><a id="__codelineno-73-111" name="__codelineno-73-111" href="#__codelineno-73-111"></a>
</span><span id="__span-73-112"><a id="__codelineno-73-112" name="__codelineno-73-112" href="#__codelineno-73-112"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span><span id="__span-73-113"><a id="__codelineno-73-113" name="__codelineno-73-113" href="#__codelineno-73-113"></a><span class="p">}</span>
</span><span id="__span-73-114"><a id="__codelineno-73-114" name="__codelineno-73-114" href="#__codelineno-73-114"></a>
</span><span id="__span-73-115"><a id="__codelineno-73-115" name="__codelineno-73-115" href="#__codelineno-73-115"></a><span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">(){</span>
</span><span id="__span-73-116"><a id="__codelineno-73-116" name="__codelineno-73-116" href="#__codelineno-73-116"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">shouldReboot</span><span class="p">){</span>
</span><span id="__span-73-117"><a id="__codelineno-73-117" name="__codelineno-73-117" href="#__codelineno-73-117"></a><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Rebooting...&quot;</span><span class="p">);</span>
</span><span id="__span-73-118"><a id="__codelineno-73-118" name="__codelineno-73-118" href="#__codelineno-73-118"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span><span id="__span-73-119"><a id="__codelineno-73-119" name="__codelineno-73-119" href="#__codelineno-73-119"></a><span class="w">    </span><span class="n">ESP</span><span class="p">.</span><span class="n">restart</span><span class="p">();</span>
</span><span id="__span-73-120"><a id="__codelineno-73-120" name="__codelineno-73-120" href="#__codelineno-73-120"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-73-121"><a id="__codelineno-73-121" name="__codelineno-73-121" href="#__codelineno-73-121"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
</span><span id="__span-73-122"><a id="__codelineno-73-122" name="__codelineno-73-122" href="#__codelineno-73-122"></a><span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Seconds since boot: %u&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">millis</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
</span><span id="__span-73-123"><a id="__codelineno-73-123" name="__codelineno-73-123" href="#__codelineno-73-123"></a><span class="w">  </span><span class="n">events</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;time&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">//send event &quot;time&quot;</span>
</span><span id="__span-73-124"><a id="__codelineno-73-124" name="__codelineno-73-124" href="#__codelineno-73-124"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="setup-global-and-class-functions-as-request-handlers">Setup global and class functions as request handlers<a class="headerlink" href="#setup-global-and-class-functions-as-request-handlers" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Arduino.h&gt;</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ESPAsyncWebserver.h&gt;</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Hash.h&gt;</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">handleRequest</span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){}</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">WebClass</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="k">public</span><span class="w"> </span><span class="o">:</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="w">  </span><span class="n">AsyncWebServer</span><span class="w"> </span><span class="n">classWebServer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AsyncWebServer</span><span class="p">(</span><span class="mi">81</span><span class="p">);</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="w">  </span><span class="n">WebClass</span><span class="p">(){};</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">classRequest</span><span class="w"> </span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">){}</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">begin</span><span class="p">(){</span>
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="w">    </span><span class="c1">// attach global request handler</span>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="w">    </span><span class="n">classWebServer</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/example&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_ANY</span><span class="p">,</span><span class="w"> </span><span class="n">handleRequest</span><span class="p">);</span>
</span><span id="__span-74-19"><a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a>
</span><span id="__span-74-20"><a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a><span class="w">    </span><span class="c1">// attach class request handler</span>
</span><span id="__span-74-21"><a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a><span class="w">    </span><span class="n">classWebServer</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/example&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_ANY</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WebClass</span><span class="o">::</span><span class="n">classRequest</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>
</span><span id="__span-74-22"><a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-74-23"><a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a><span class="p">};</span>
</span><span id="__span-74-24"><a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a>
</span><span id="__span-74-25"><a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a><span class="n">AsyncWebServer</span><span class="w"> </span><span class="nf">globalWebServer</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
</span><span id="__span-74-26"><a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a><span class="n">WebClass</span><span class="w"> </span><span class="n">webClassInstance</span><span class="p">;</span>
</span><span id="__span-74-27"><a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a>
</span><span id="__span-74-28"><a id="__codelineno-74-28" name="__codelineno-74-28" href="#__codelineno-74-28"></a><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-74-29"><a id="__codelineno-74-29" name="__codelineno-74-29" href="#__codelineno-74-29"></a><span class="w">  </span><span class="c1">// attach global request handler</span>
</span><span id="__span-74-30"><a id="__codelineno-74-30" name="__codelineno-74-30" href="#__codelineno-74-30"></a><span class="w">  </span><span class="n">globalWebServer</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/example&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_ANY</span><span class="p">,</span><span class="w"> </span><span class="n">handleRequest</span><span class="p">);</span>
</span><span id="__span-74-31"><a id="__codelineno-74-31" name="__codelineno-74-31" href="#__codelineno-74-31"></a>
</span><span id="__span-74-32"><a id="__codelineno-74-32" name="__codelineno-74-32" href="#__codelineno-74-32"></a><span class="w">  </span><span class="c1">// attach class request handler</span>
</span><span id="__span-74-33"><a id="__codelineno-74-33" name="__codelineno-74-33" href="#__codelineno-74-33"></a><span class="w">  </span><span class="n">globalWebServer</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/example&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_ANY</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WebClass</span><span class="o">::</span><span class="n">classRequest</span><span class="p">,</span><span class="w"> </span><span class="n">webClassInstance</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>
</span><span id="__span-74-34"><a id="__codelineno-74-34" name="__codelineno-74-34" href="#__codelineno-74-34"></a><span class="p">}</span>
</span><span id="__span-74-35"><a id="__codelineno-74-35" name="__codelineno-74-35" href="#__codelineno-74-35"></a>
</span><span id="__span-74-36"><a id="__codelineno-74-36" name="__codelineno-74-36" href="#__codelineno-74-36"></a><span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-74-37"><a id="__codelineno-74-37" name="__codelineno-74-37" href="#__codelineno-74-37"></a>
</span><span id="__span-74-38"><a id="__codelineno-74-38" name="__codelineno-74-38" href="#__codelineno-74-38"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="methods-for-controlling-websocket-connections">Methods for controlling websocket connections<a class="headerlink" href="#methods-for-controlling-websocket-connections" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="w">  </span><span class="c1">// Disable client connections if it was activated</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ws</span><span class="p">.</span><span class="n">enabled</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="w">    </span><span class="n">ws</span><span class="p">.</span><span class="n">enable</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">  </span><span class="c1">// enable client connections if it was disabled</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">ws</span><span class="p">.</span><span class="n">enabled</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="w">    </span><span class="n">ws</span><span class="p">.</span><span class="n">enable</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span></code></pre></div>
<p>Example of OTA code</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="w">  </span><span class="c1">// OTA callbacks</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="w">  </span><span class="n">ArduinoOTA</span><span class="p">.</span><span class="n">onStart</span><span class="p">([]()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="w">    </span><span class="c1">// Clean SPIFFS</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="w">    </span><span class="n">SPIFFS</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="w">    </span><span class="c1">// Disable client connections</span>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="w">    </span><span class="n">ws</span><span class="p">.</span><span class="n">enable</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="w">    </span><span class="c1">// Advertise connected clients what&#39;s going on</span>
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="w">    </span><span class="n">ws</span><span class="p">.</span><span class="n">textAll</span><span class="p">(</span><span class="s">&quot;OTA Update Started&quot;</span><span class="p">);</span>
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a>
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a><span class="w">    </span><span class="c1">// Close them</span>
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a><span class="w">    </span><span class="n">ws</span><span class="p">.</span><span class="n">closeAll</span><span class="p">();</span>
</span><span id="__span-76-14"><a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a>
</span><span id="__span-76-15"><a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a><span class="w">  </span><span class="p">});</span>
</span></code></pre></div>
<h4 id="adding-default-headers">Adding Default Headers<a class="headerlink" href="#adding-default-headers" title="Permanent link">&para;</a></h4>
<p>In some cases, such as when working with CORS, or with some sort of custom authentication system,
you might need to define a header that should get added to all responses (including static, websocket and EventSource).
The DefaultHeaders singleton allows you to do this.</p>
<p>Example:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="n">DefaultHeaders</span><span class="o">::</span><span class="n">Instance</span><span class="p">().</span><span class="n">addHeader</span><span class="p">(</span><span class="s">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;*&quot;</span><span class="p">);</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="n">webServer</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></code></pre></div>
<p><em>NOTE</em>: You will still need to respond to the OPTIONS method for CORS pre-flight in most cases. (unless you are only using GET)</p>
<p>This is one option:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="n">webServer</span><span class="p">.</span><span class="n">onNotFound</span><span class="p">([](</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">method</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">HTTP_OPTIONS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="p">});</span>
</span></code></pre></div>
<h4 id="path-variable">Path variable<a class="headerlink" href="#path-variable" title="Permanent link">&para;</a></h4>
<p>With path variable you can create a custom regex rule for a specific parameter in a route.
For example we want a <code>sensorId</code> parameter in a route rule to match only a integer.</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;^</span><span class="se">\\</span><span class="s">/sensor</span><span class="se">\\</span><span class="s">/([0-9]+)$&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HTTP_GET</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">(</span><span class="n">AsyncWebServerRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">sensorId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">pathArg</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="w">  </span><span class="p">});</span>
</span></code></pre></div>
<p><em>NOTE</em>: All regex patterns starts with <code>^</code> and ends with <code>$</code></p>
<p>To enable the <code>Path variable</code> support, you have to define the buildflag <code>-DASYNCWEBSERVER_REGEX</code>.</p>
<p>For Arduino IDE create/update <code>platform.local.txt</code>:</p>
<p><code>Windows</code>: C:\Users(username)\AppData\Local\Arduino15\packages\<code>{espxxxx}</code>\hardware\<code>espxxxx</code>\<code>{version}</code>\platform.local.txt</p>
<p><code>Linux</code>: ~/.arduino15/packages/<code>{espxxxx}</code>/hardware/<code>{espxxxx}</code>/<code>{version}</code>/platform.local.txt</p>
<p>Add/Update the following line:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>  compiler.cpp.extra_flags=-DASYNCWEBSERVER_REGEX
</span></code></pre></div>
<p>For platformio modify <code>platformio.ini</code>:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="k">[env:myboard]</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="na">build_flags</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="w">  </span><span class="na">-DASYNCWEBSERVER_REGEX</span>
</span></code></pre></div>
<p><em>NOTE</em>: By enabling <code>ASYNCWEBSERVER_REGEX</code>, <code>&lt;regex&gt;</code> will be included. This will add an 100k to your binary.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "navigation.expand", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>